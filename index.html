<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Spotafe ‚Äî Sortez l'esprit tranquille</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  :root {
    --green: #00E87A;
    --green-dark: #00C065;
    --green-glow: rgba(0,232,122,0.2);
    --red: #FF3B5C;
    --orange: #FF8C00;
    --bg: #0A0A0F;
    --bg2: #111118;
    --bg3: #1A1A24;
    --card: #16161F;
    --border: rgba(255,255,255,0.07);
    --text: #F0F0F8;
    --muted: rgba(240,240,248,0.45);
    --accent: #00E87A;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  /* PHONE FRAME */
  .phone {
    width: 390px;
    height: 844px;
    background: var(--bg);
    border-radius: 54px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 0 0 12px #1C1C1E, 0 0 0 14px #2C2C2E, 0 40px 120px rgba(0,0,0,0.8), 0 0 60px rgba(0,232,122,0.06);
  }

  /* NOTCH */
  .notch {
    position: absolute;
    top: 0; left: 50%;
    transform: translateX(-50%);
    width: 126px; height: 34px;
    background: #0A0A0F;
    border-radius: 0 0 20px 20px;
    z-index: 100;
  }

  /* STATUS BAR */
  .status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 28px 0;
    font-size: 12px;
    font-weight: 600;
    color: var(--text);
    position: relative;
    z-index: 99;
  }
  .status-bar .time { font-size: 15px; font-weight: 700; }
  .status-icons { display: flex; gap: 6px; align-items: center; }
  .status-icons svg { opacity: 0.9; }

  /* SCREENS */
  .screen {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    overflow-y: auto;
    overflow-x: hidden;
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    scrollbar-width: none;
    transition: opacity 0.2s ease;
  }
  .screen::-webkit-scrollbar { display: none; }
  .screen.active {
    visibility: visible;
    opacity: 1;
    pointer-events: all;
  }

  /* ‚îÄ‚îÄ SPLASH SCREEN ‚îÄ‚îÄ */
  #splash {
    background: radial-gradient(ellipse at 50% 40%, rgba(0,232,122,0.15) 0%, transparent 70%), var(--bg);
  }
  #splash > div {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
  }
  .splash-logo {
    font-family: 'Syne', sans-serif;
    font-size: 52px;
    font-weight: 800;
    letter-spacing: -2px;
    color: var(--green);
    animation: pulse 2s ease-in-out infinite;
  }
  .splash-logo span { color: var(--text); }
  .splash-tagline {
    color: var(--muted);
    font-size: 14px;
    margin-top: 8px;
    letter-spacing: 0.5px;
  }
  .splash-orb {
    width: 180px; height: 180px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(0,232,122,0.3) 0%, transparent 70%);
    position: absolute;
    animation: float 3s ease-in-out infinite;
    filter: blur(20px);
  }
  @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-15px)} }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.7} }

  .role-cards {
    display: flex;
    flex-direction: column;
    gap: 14px;
    padding: 0 28px;
    width: 100%;
    margin-top: 48px;
    position: relative;
    z-index: 2;
  }
  .role-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 22px 24px;
    display: flex;
    align-items: center;
    gap: 18px;
    cursor: pointer;
    transition: all 0.25s ease;
    position: relative;
    overflow: hidden;
  }
  .role-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(0,232,122,0.08) 0%, transparent 60%);
    opacity: 0;
    transition: opacity 0.25s;
  }
  .role-card:active::before { opacity: 1; }
  .role-card:active { transform: scale(0.97); }
  .role-icon {
    width: 52px; height: 52px;
    border-radius: 16px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
  }
  .role-icon.client { background: rgba(0,232,122,0.15); }
  .role-icon.bar { background: rgba(255,140,0,0.15); }
  .role-info { flex: 1; }
  .role-title {
    font-family: 'Syne', sans-serif;
    font-size: 17px;
    font-weight: 700;
    margin-bottom: 3px;
  }
  .role-desc { font-size: 13px; color: var(--muted); line-height: 1.4; }
  .role-arrow { color: var(--muted); font-size: 18px; }

  /* ‚îÄ‚îÄ CLIENT SCREEN ‚îÄ‚îÄ */
  #client { background: var(--bg); }
  
  .client-header {
    padding: 52px 24px 20px;
    background: linear-gradient(to bottom, rgba(0,232,122,0.05), transparent);
  }
  .header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  .app-logo-small {
    font-family: 'Outfit', sans-serif;
    font-size: 22px;
    font-weight: 900;
    letter-spacing: -0.5px;
  }
  .app-logo-small .s   { color: var(--green); }
  .app-logo-small .pot { color: rgba(240,240,248,0.28); font-weight: 300; }
  .app-logo-small .afe { color: var(--green); }
  .back-btn {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 8px 14px;
    font-size: 13px;
    color: var(--muted);
    cursor: pointer;
  }
  .back-btn:active { opacity: 0.7; }

  .location-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(0,232,122,0.1);
    border: 1px solid rgba(0,232,122,0.25);
    border-radius: 20px;
    padding: 8px 14px;
    font-size: 13px;
    color: var(--green);
    margin-bottom: 16px;
  }
  .location-dot {
    width: 7px; height: 7px;
    background: var(--green);
    border-radius: 50%;
    animation: blink 1.5s ease-in-out infinite;
  }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

  .section-title {
    font-family: 'Syne', sans-serif;
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 4px;
  }
  .section-sub { font-size: 13px; color: var(--muted); }

  /* MAP */
  .map-container {
    margin: 0 24px 20px;
    border-radius: 20px;
    overflow: hidden;
    height: 180px;
    background: var(--card);
    border: 1px solid var(--border);
    position: relative;
  }
  /* Leaflet overrides dark */
  .leaflet-tile-pane { filter: brightness(0.85) saturate(0.7); }
  .leaflet-control-attribution { display: none; }
  .leaflet-control-zoom { display: none; }
  .spotafe-marker {
    background: #00E87A;
    color: #000;
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 800;
    padding: 4px 8px;
    border-radius: 10px;
    white-space: nowrap;
    box-shadow: 0 4px 12px rgba(0,232,122,0.5);
    cursor: pointer;
  }
  .spotafe-marker.orange {
    background: #FF8C00;
    box-shadow: 0 4px 12px rgba(255,140,0,0.5);
  }

  /* BAR CARDS */
  .bars-list { padding: 0 24px 96px; display: flex; flex-direction: column; gap: 14px; }

  .bar-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 18px 20px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }
  .bar-card::after {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
    background: var(--green);
    border-radius: 0 2px 2px 0;
  }
  .bar-card:active { transform: scale(0.98); }
  .bar-card-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
  }
  .bar-name {
    font-family: 'Syne', sans-serif;
    font-size: 17px;
    font-weight: 700;
  }
  .bar-type { font-size: 12px; color: var(--muted); margin-top: 2px; }

  .score-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: rgba(0,232,122,0.1);
    border: 1px solid rgba(0,232,122,0.25);
    border-radius: 14px;
    padding: 8px 14px;
    min-width: 62px;
  }
  .score-badge.orange {
    background: rgba(255,140,0,0.1);
    border-color: rgba(255,140,0,0.25);
  }
  .score-num {
    font-family: 'Syne', sans-serif;
    font-size: 22px;
    font-weight: 800;
    color: var(--green);
    line-height: 1;
  }
  .score-num.orange { color: var(--orange); }
  .score-label { font-size: 10px; color: var(--muted); margin-top: 2px; }

  .score-bar-wrap {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }
  .score-bar-track {
    flex: 1;
    height: 6px;
    background: rgba(255,255,255,0.06);
    border-radius: 3px;
    overflow: hidden;
  }
  .score-bar-fill {
    height: 100%;
    border-radius: 3px;
    background: linear-gradient(90deg, var(--green-dark), var(--green));
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .score-bar-fill.orange {
    background: linear-gradient(90deg, #CC7000, var(--orange));
  }
  .score-pct { font-size: 12px; color: var(--muted); width: 32px; text-align: right; }

  .bar-meta {
    display: flex;
    gap: 16px;
    font-size: 12px;
    color: var(--muted);
  }
  .bar-meta-item { display: flex; align-items: center; gap: 4px; }

  .certif-pills {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 10px;
  }
  .certif-pill {
    background: rgba(0,232,122,0.08);
    border: 1px solid rgba(0,232,122,0.15);
    border-radius: 8px;
    padding: 3px 9px;
    font-size: 11px;
    color: var(--green);
  }
  .certif-pill.warning {
    background: rgba(255,59,92,0.08);
    border-color: rgba(255,59,92,0.15);
    color: var(--red);
  }

  /* TAB BAR */
  .tab-bar {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 84px;
    background: rgba(10,10,15,0.97);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid var(--border);
    display: none;
    align-items: flex-start;
    padding-top: 12px;
    z-index: 200;
    flex-shrink: 0;
  }
  .tab-bar.visible { display: flex; }
  .tab-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    padding: 4px 0;
  }
  .tab-icon { font-size: 22px; opacity: 0.4; }
  .tab-icon.active { opacity: 1; }
  .tab-txt { font-size: 10px; color: var(--muted); }
  .tab-txt.active { color: var(--green); }

  /* ‚îÄ‚îÄ BAR OWNER SCREEN ‚îÄ‚îÄ */
  #barowner { background: var(--bg); }

  .bar-header {
    padding: 52px 24px 24px;
    background: linear-gradient(to bottom, rgba(255,140,0,0.06), transparent);
  }
  .bar-header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .establishment-name {
    font-family: 'Syne', sans-serif;
    font-size: 24px;
    font-weight: 800;
    margin-bottom: 4px;
  }
  .establishment-sub { font-size: 13px; color: var(--muted); }

  /* BIG SCORE */
  .big-score-card {
    margin: 0 24px 20px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 28px 24px;
    position: relative;
    overflow: hidden;
  }
  .big-score-card::before {
    content: '';
    position: absolute;
    top: -40px; right: -40px;
    width: 160px; height: 160px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,140,0,0.12) 0%, transparent 70%);
  }
  .score-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  .big-score-num {
    font-family: 'Syne', sans-serif;
    font-size: 72px;
    font-weight: 800;
    color: var(--orange);
    line-height: 1;
  }
  .big-score-denom {
    font-family: 'Syne', sans-serif;
    font-size: 28px;
    font-weight: 600;
    color: var(--muted);
    align-self: flex-end;
    padding-bottom: 10px;
  }
  .score-ring {
    width: 90px; height: 90px;
    position: relative;
  }
  .score-ring svg { transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: rgba(255,255,255,0.06); stroke-width: 8; }
  .ring-fill { fill: none; stroke: var(--orange); stroke-width: 8; stroke-linecap: round;
    stroke-dasharray: 226; stroke-dashoffset: 45; transition: stroke-dashoffset 1s ease; }
  .ring-label {
    position: absolute;
    inset: 0;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif;
    font-size: 18px; font-weight: 800;
    color: var(--orange);
  }

  .score-label-main {
    font-size: 13px; color: var(--muted); margin-bottom: 6px;
  }
  .score-trend {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: rgba(0,232,122,0.1);
    border: 1px solid rgba(0,232,122,0.2);
    border-radius: 10px;
    padding: 4px 10px;
    font-size: 12px;
    color: var(--green);
    font-weight: 600;
  }

  /* CRITERIA */
  .criteria-section { padding: 0 24px 20px; }
  .criteria-title {
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 14px;
  }
  .criteria-list { display: flex; flex-direction: column; gap: 10px; }
  .criteria-item {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 14px 16px;
    display: flex;
    align-items: center;
    gap: 14px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .criteria-item:active { transform: scale(0.98); }
  .criteria-icon {
    width: 40px; height: 40px;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }
  .ci-green { background: rgba(0,232,122,0.1); }
  .ci-orange { background: rgba(255,140,0,0.1); }
  .ci-red { background: rgba(255,59,92,0.1); }
  .criteria-info { flex: 1; }
  .criteria-name { font-size: 14px; font-weight: 500; margin-bottom: 4px; }
  .criteria-bar-wrap { display: flex; align-items: center; gap: 8px; }
  .criteria-bar-track {
    flex: 1; height: 4px;
    background: rgba(255,255,255,0.06);
    border-radius: 2px; overflow: hidden;
  }
  .criteria-bar-fill {
    height: 100%; border-radius: 2px;
    background: var(--green);
  }
  .criteria-bar-fill.orange { background: var(--orange); }
  .criteria-bar-fill.red { background: var(--red); }
  .criteria-pct { font-size: 12px; color: var(--muted); }
  .criteria-status {
    font-size: 11px;
    padding: 3px 10px;
    border-radius: 8px;
    font-weight: 600;
  }
  .cs-ok { background: rgba(0,232,122,0.1); color: var(--green); }
  .cs-warn { background: rgba(255,140,0,0.1); color: var(--orange); }
  .cs-bad { background: rgba(255,59,92,0.1); color: var(--red); }

  /* ACTIONS */
  .actions-section { padding: 0 24px 96px; }
  .actions-title {
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 14px;
  }
  .action-btn {
    width: 100%;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 14px;
    cursor: pointer;
    margin-bottom: 10px;
    transition: all 0.2s;
  }
  .action-btn:active { transform: scale(0.98); opacity: 0.8; }
  .action-btn-icon {
    width: 44px; height: 44px;
    border-radius: 14px;
    background: rgba(0,232,122,0.1);
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
  }
  .action-btn-icon.orange { background: rgba(255,140,0,0.1); }
  .action-btn-text { flex: 1; }
  .action-btn-title { font-size: 15px; font-weight: 500; }
  .action-btn-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .action-btn-arrow { color: var(--muted); }

  /* MODAL DETAIL BAR */
  .modal-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    z-index: 200;
    display: none;
    align-items: flex-end;
  }
  .modal-overlay.open { display: flex; }
  .modal-sheet {
    width: 100%;
    background: var(--bg2);
    border-radius: 28px 28px 0 0;
    border-top: 1px solid var(--border);
    padding: 12px 24px 40px;
    max-height: 80%;
    overflow-y: auto;
  }
  .modal-sheet::-webkit-scrollbar { display: none; }
  .modal-handle {
    width: 36px; height: 4px;
    background: rgba(255,255,255,0.15);
    border-radius: 2px;
    margin: 0 auto 20px;
  }
  .modal-bar-name {
    font-family: 'Syne', sans-serif;
    font-size: 24px;
    font-weight: 800;
    margin-bottom: 4px;
  }
  .modal-bar-addr { font-size: 13px; color: var(--muted); margin-bottom: 20px; }
  .modal-score-big {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    background: var(--card);
    border-radius: 18px;
    padding: 16px 20px;
    border: 1px solid var(--border);
  }
  .modal-score-num {
    font-family: 'Syne', sans-serif;
    font-size: 48px;
    font-weight: 800;
    color: var(--green);
    line-height: 1;
  }
  .modal-score-num.orange { color: var(--orange); }
  .modal-score-info { flex: 1; }
  .modal-score-label { font-size: 13px; color: var(--muted); margin-bottom: 6px; }
  .modal-score-bar-track {
    height: 8px;
    background: rgba(255,255,255,0.06);
    border-radius: 4px; overflow: hidden;
  }
  .modal-score-bar-fill {
    height: 100%; border-radius: 4px;
    background: linear-gradient(90deg, var(--green-dark), var(--green));
  }
  .modal-score-bar-fill.orange {
    background: linear-gradient(90deg, #CC7000, var(--orange));
  }
  .modal-section-title {
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 12px;
  }
  .modal-detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 20px;
  }
  .modal-detail-item {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 12px 14px;
  }
  .modal-detail-label { font-size: 11px; color: var(--muted); margin-bottom: 4px; }
  .modal-detail-value { font-size: 14px; font-weight: 600; }
  .modal-detail-value.green { color: var(--green); }
  .modal-detail-value.orange { color: var(--orange); }
  .modal-detail-value.red { color: var(--red); }
  .modal-cta {
    width: 100%;
    background: var(--green);
    color: #000;
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    border: none;
    border-radius: 16px;
    padding: 17px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    margin-top: 8px;
    transition: all 0.2s;
  }
  .modal-cta:active { transform: scale(0.97); background: var(--green-dark); }

  /* TOAST */
  .toast {
    position: absolute;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 12px 20px;
    font-size: 13px;
    white-space: nowrap;
    z-index: 300;
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
  }
  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  /* Animations d'entr√©e */
  @keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .bar-card { animation: slideUp 0.4s ease both; }
  .bar-card:nth-child(1) { animation-delay: 0.1s; }
  .bar-card:nth-child(2) { animation-delay: 0.2s; }
  .bar-card:nth-child(3) { animation-delay: 0.3s; }

  /* PARTNERS SECTION */
  .partners-screen { display: none; padding: 52px 24px 100px; }
  .partners-screen.active { display: block; }

  .search-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 12px 16px;
    margin-bottom: 8px;
  }
  .search-bar input {
    flex: 1;
    background: none;
    border: none;
    outline: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    color: var(--text);
  }
  .search-bar input::placeholder { color: var(--muted); }
  .search-bar .search-icon { font-size: 18px; }

  .filter-pills {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding-bottom: 4px;
    margin-bottom: 20px;
    scrollbar-width: none;
  }
  .filter-pills::-webkit-scrollbar { display: none; }
  .filter-pill {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 6px 14px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--muted);
    white-space: nowrap;
  }
  .filter-pill.active {
    background: rgba(0,232,122,0.12);
    border-color: rgba(0,232,122,0.35);
    color: var(--green);
  }
  .filter-pill:active { transform: scale(0.95); }
  #clientMapFilters .filter-pill {
    white-space: normal;
    font-size: 11px;
    font-weight: 600;
    border-radius: 10px;
  }
  #clientMapFilters .filter-pill.active {
    font-weight: 700;
  }

  .partner-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 18px 20px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .partner-card:active { transform: scale(0.98); }
  .partner-card-top {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    margin-bottom: 12px;
  }
  .partner-logo {
    width: 52px; height: 52px;
    border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
    border: 1px solid var(--border);
  }
  .partner-info { flex: 1; }
  .partner-name {
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 2px;
  }
  .partner-type { font-size: 12px; color: var(--muted); margin-bottom: 6px; }
  .partner-badges { display: flex; gap: 6px; flex-wrap: wrap; }
  .partner-badge {
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 6px;
    font-weight: 600;
  }
  .pb-agr√©√© { background: rgba(0,232,122,0.1); color: var(--green); border: 1px solid rgba(0,232,122,0.2); }
  .pb-local { background: rgba(74,158,255,0.1); color: #4A9EFF; border: 1px solid rgba(74,158,255,0.2); }
  .pb-rapide { background: rgba(255,140,0,0.1); color: var(--orange); border: 1px solid rgba(255,140,0,0.2); }
  .pb-certif { background: rgba(160,100,255,0.1); color: #A064FF; border: 1px solid rgba(160,100,255,0.2); }

  .partner-divider {
    height: 1px;
    background: var(--border);
    margin-bottom: 12px;
  }
  .partner-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  .partner-meta-item { font-size: 12px; color: var(--muted); display: flex; align-items: center; gap: 4px; }
  .partner-price {
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
  }
  .partner-price span { font-size: 11px; font-weight: 400; color: var(--muted); }

  .partner-services {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 14px;
  }
  .partner-service {
    background: var(--bg3);
    border-radius: 8px;
    padding: 4px 10px;
    font-size: 11px;
    color: var(--muted);
  }

  .partner-cta {
    display: flex;
    gap: 8px;
  }
  .partner-btn {
    flex: 1;
    padding: 11px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }
  .partner-btn:active { transform: scale(0.97); }
  .partner-btn-primary {
    background: var(--green);
    color: #000;
  }
  .partner-btn-secondary {
    background: var(--card);
    border: 1px solid var(--border);
    color: var(--text);
  }

  .partners-header { margin-bottom: 20px; }
  .partners-count { font-size: 13px; color: var(--muted); margin-top: 4px; }

  /* Owner sub-screens */
  .owner-sub { display: none; }
  .owner-sub.active { display: block; }

  /* Desktop hint */
  @media (min-width: 500px) {
    body { background: #070708; }
  }
</style>
</head>
<body>

<!-- PHONE FRAME -->
<div class="phone">
  <div class="notch"></div>

  <!-- STATUS BAR -->
  <div class="status-bar">
    <span class="time" id="clock">09:41</span>
    <div class="status-icons">
      <svg width="17" height="12" viewBox="0 0 17 12" fill="white">
        <rect x="0" y="3" width="3" height="9" rx="1" opacity="0.3"/>
        <rect x="4.5" y="2" width="3" height="10" rx="1" opacity="0.5"/>
        <rect x="9" y="0" width="3" height="12" rx="1" opacity="0.7"/>
        <rect x="13.5" y="0" width="3" height="12" rx="1"/>
      </svg>
      <svg width="16" height="12" viewBox="0 0 16 12" fill="white">
        <path d="M8 2.4C5.6 2.4 3.4 3.4 1.8 5L0 3.2C2.2 1.2 5 0 8 0s5.8 1.2 8 3.2L14.2 5C12.6 3.4 10.4 2.4 8 2.4z"/>
        <path d="M8 6.4c-1.4 0-2.6.6-3.5 1.5L3 6.4C4.3 5 6 4.2 8 4.2s3.7.8 5 2.2l-1.5 1.5C10.6 7 9.4 6.4 8 6.4z"/>
        <circle cx="8" cy="11" r="1.5"/>
      </svg>
      <svg width="25" height="12" viewBox="0 0 25 12" fill="white">
        <rect x="0" y="1" width="21" height="10" rx="3" stroke="white" stroke-width="1.5" fill="none" opacity="0.4"/>
        <rect x="22" y="4" width="3" height="4" rx="1" opacity="0.4"/>
        <rect x="1.5" y="2.5" width="16" height="7" rx="2" fill="white"/>
      </svg>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SPLASH SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen active" id="splash">
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:40px 28px;">
      <div class="splash-orb"></div>
      <div style="position:relative;z-index:2;text-align:center;margin-bottom:60px;">
        <div class="splash-logo" style="font-size:0"><svg width="180" height="52" viewBox="0 0 268 76" fill="none" xmlns="http://www.w3.org/2000/svg">
<defs>
  <linearGradient id="Lgo" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#F5D07A"/><stop offset="50%" stop-color="#E8B84B"/><stop offset="100%" stop-color="#C9962A"/></linearGradient>
  <linearGradient id="Lgf" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00C878" stop-opacity=".18"/><stop offset="100%" stop-color="#00C878" stop-opacity=".04"/></linearGradient>
  <filter id="Lgg"><feGaussianBlur stdDeviation="5"/></filter>
</defs>
<ellipse cx="35" cy="40" rx="28" ry="22" fill="#C9962A" opacity=".12" filter="url(#Lgg)"/>
<path d="M35 5 L62 38 L35 71 L8 38 Z" fill="url(#Lgf)"/>
<path d="M35 5 L62 38 L35 71 L8 38 Z" fill="none" stroke="url(#Lgo)" stroke-width="2.2"/>
<path d="M35 5 L35 38 M8 38 L62 38 M35 38 L35 71" stroke="url(#Lgo)" stroke-width=".6" opacity=".4"/>
<path d="M25 28 C25 24.7 27.7 22 31 22 L39 22 C42.3 22 45 24.7 45 28 C45 31.3 42.3 34 39 34 L31 34 C27.7 34 25 36.7 25 40 C25 43.3 27.7 46 31 46 L39 46 C42.3 46 45 43.3 45 40" stroke="#00C878" stroke-width="2.8" stroke-linecap="round" fill="none"/>
<circle cx="35" cy="7"  r="2.4" fill="url(#Lgo)"/>
<circle cx="35" cy="69" r="2"   fill="url(#Lgo)" opacity=".8"/>
<circle cx="10" cy="38" r="1.5" fill="url(#Lgo)" opacity=".6"/>
<circle cx="60" cy="38" r="1.5" fill="url(#Lgo)" opacity=".6"/>
<text x="77" y="44" font-family="Outfit,sans-serif" font-weight="900" font-size="34" letter-spacing="-1">
  <tspan fill="#00C878">S</tspan><tspan fill="rgba(240,240,248,0.3)" font-weight="300">pot</tspan><tspan fill="#00C878">afe</tspan>
</text>
<circle cx="170" cy="14" r="4.2" fill="url(#Lgo)"/>
</svg></div>
        <div class="splash-tagline" style="margin-top:12px;font-size:13px;letter-spacing:0.5px;">Parce que chaque sortie compte</div>
      </div>
      <div class="role-cards" style="margin-top:0;">
        <div class="role-card" onclick="goTo('client')">
          <div class="role-icon client">üß≠</div>
          <div class="role-info">
            <div class="role-title">Je suis un client</div>
            <div class="role-desc">Trouvez des bars s√©curis√©s pr√®s de vous ‚Äî pilote Tours &amp; Paris</div>
          </div>
          <div class="role-arrow">‚Ä∫</div>
        </div>
        <div class="role-card" onclick="goTo('barowner')">
          <div class="role-icon bar">üè™</div>
          <div class="role-info">
            <div class="role-title">Je g√®re un √©tablissement</div>
            <div class="role-desc">Gratuit ¬∑ Score public + badge vitrine certifi√©</div>
          </div>
          <div class="role-arrow">‚Ä∫</div>
        </div>
        <div class="role-card" onclick="goTo('parent')" style="border-color:rgba(160,100,255,0.3);">
          <div class="role-icon" style="background:rgba(160,100,255,0.15);font-size:24px;">üë®‚Äçüë©‚Äçüëß</div>
          <div class="role-info">
            <div class="role-title">Je suis parent</div>
            <div class="role-desc">Suivez la position de votre enfant ¬∑ Sachez s'il est dans un lieu s√©curis√©</div>
          </div>
          <div class="role-arrow">‚Ä∫</div>
        </div>
      </div>
      <div style="margin-top:32px;font-size:12px;color:rgba(240,240,248,0.25);text-align:center;line-height:1.5;">
        Donn√©es ERP ‚Ä¢ Certificats de s√©curit√©<br>Gratuit pour les g√©rants ¬∑ Transparent pour tous
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLIENT SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="client">
    <div class="client-header">
      <div class="header-top">
        <div class="app-logo-small"><span class="s">S</span><span class="pot">pot</span><span class="afe">afe</span></div>
        <div class="back-btn" onclick="goTo('splash')">‚Üê Retour</div>
      </div>
      <div class="location-pill" id="locationPill">
        <div class="location-dot"></div>
        <span id="locationText">Localisation en cours‚Ä¶</span>
      </div>
      <div class="section-title">Bars pr√®s de vous</div>
      <div class="section-sub">7 √©tablissements ‚Ä¢ Tours &amp; Paris ‚Äî Pilote b√™ta</div>
      <!-- Filtres score/distance -->
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;padding:8px 0 4px;" id="clientMapFilters">
        <div class="filter-pill active" onclick="applyMapFilter('tous',this)" style="text-align:center;padding:6px 4px;">Tous</div>
        <div class="filter-pill" onclick="applyMapFilter('top',this)" style="text-align:center;padding:6px 4px;">‚úÖ &gt;85</div>
        <div class="filter-pill" onclick="applyMapFilter('warning',this)" style="text-align:center;padding:6px 4px;">‚ö†Ô∏è Risque</div>
        <div class="filter-pill" onclick="applyMapFilter('tours',this)" style="text-align:center;padding:6px 4px;">üìç Tours</div>
        <div class="filter-pill" onclick="applyMapFilter('paris',this)" style="text-align:center;padding:6px 4px;">üóº Paris</div>
        <div class="filter-pill" onclick="applyMapFilter('open',this)" style="text-align:center;padding:6px 4px;">üïê Ouvert</div>
      </div>
    </div>

    <!-- MAP LEAFLET -->
    <div class="map-container" id="mapContainer">
      <div id="leafletMap" style="width:100%;height:100%;"></div>
    </div>

    <!-- BARS LIST -->
    <div class="bars-list">

      <!-- Bar 1 -->
      <div class="bar-card" data-idx="0" onclick="openModal(0)">
        <div class="bar-card-top">
          <div>
            <div class="bar-name">Le Vieux Murier</div>
            <div class="bar-type">Bar ‚Äî 12 Place Plumereau</div>
          </div>
          <div class="score-badge">
            <div class="score-num">82</div>
            <div class="score-label">/100</div>
          </div>
        </div>
        <div class="score-bar-wrap">
          <div class="score-bar-track"><div class="score-bar-fill" style="width:82%"></div></div>
          <div class="score-pct">82%</div>
        </div>
        <div class="bar-meta">
          <div class="bar-meta-item">üìç 320m</div>
          <div class="bar-meta-item">üïê Ouvert</div>
          <div class="bar-meta-item">üë• ~40 pers.</div>
        </div>
        <div class="certif-pills">
          <div class="certif-pill">‚úì Extincteurs</div>
          <div class="certif-pill">‚úì Issues secours</div>
          <div class="certif-pill warning">‚ö† D√©tecteurs</div>
        </div>
      </div>

      <!-- Bar 2 -->
      <div class="bar-card" style="border-color:rgba(255,140,0,0.2);" data-idx="1" onclick="openModal(1)">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--orange);border-radius:0 2px 2px 0;"></div>
        <div class="bar-card-top">
          <div>
            <div class="bar-name">Bar du Centre</div>
            <div class="bar-type">Bar brasserie ‚Äî 5 Rue Colbert</div>
          </div>
          <div class="score-badge orange">
            <div class="score-num orange">78</div>
            <div class="score-label">/100</div>
          </div>
        </div>
        <div class="score-bar-wrap">
          <div class="score-bar-track"><div class="score-bar-fill orange" style="width:78%"></div></div>
          <div class="score-pct">78%</div>
        </div>
        <div class="bar-meta">
          <div class="bar-meta-item">üìç 150m</div>
          <div class="bar-meta-item">üïê Ouvert</div>
          <div class="bar-meta-item">üë• ~80 pers.</div>
        </div>
        <div class="certif-pills">
          <div class="certif-pill">‚úì Extincteurs</div>
          <div class="certif-pill warning">‚ö† Issues secours</div>
          <div class="certif-pill warning">‚ö† √âclairage</div>
        </div>
      </div>

      <!-- Bar 3 -->
      <div class="bar-card" data-idx="2" onclick="openModal(2)">
        <div class="bar-card-top">
          <div>
            <div class="bar-name">La Guinguette</div>
            <div class="bar-type">Bar concert ‚Äî 8 Quai du Portillon</div>
          </div>
          <div class="score-badge">
            <div class="score-num">85</div>
            <div class="score-label">/100</div>
          </div>
        </div>
        <div class="score-bar-wrap">
          <div class="score-bar-track"><div class="score-bar-fill" style="width:85%"></div></div>
          <div class="score-pct">85%</div>
        </div>
        <div class="bar-meta">
          <div class="bar-meta-item">üìç 480m</div>
          <div class="bar-meta-item">üïê Ouvert</div>
          <div class="bar-meta-item">üë• ~120 pers.</div>
        </div>
        <div class="certif-pills">
          <div class="certif-pill">‚úì Extincteurs</div>
          <div class="certif-pill">‚úì Issues secours</div>
          <div class="certif-pill">‚úì D√©tecteurs</div>
        </div>
      </div>

    </div>

    <!-- SECTION PARIS -->
    <div style="padding:20px 24px 8px;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
        <div class="section-title" style="margin:0;">Paris ‚Äî B√™ta</div>
        <div style="background:rgba(232,184,75,0.12);border:1px solid rgba(232,184,75,0.3);color:#E8B84B;font-size:9px;font-weight:700;padding:3px 8px;border-radius:100px;letter-spacing:.04em;">üü° PILOTE PARIS</div>
      </div>
      <div class="section-sub">4 √©tablissements ‚Ä¢ Marais &amp; Oberkampf ¬∑ acc√®s b√™ta</div>
    </div>
    <div class="bars-list">

      <!-- Paris 1 ‚Äî Le Marais -->
      <div class="bar-card" data-idx="3" onclick="openModal(3)">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:#E8B84B;border-radius:0 2px 2px 0;"></div>
        <div style="position:absolute;top:10px;right:10px;background:rgba(232,184,75,0.12);border:1px solid rgba(232,184,75,0.3);color:#E8B84B;font-size:8px;font-weight:700;padding:2px 7px;border-radius:100px;">üóº Paris</div>
        <div class="bar-card-top" style="padding-right:60px;">
          <div>
            <div class="bar-name">Le Marais Social Club</div>
            <div class="bar-type">Bar cocktails ‚Äî 18 Rue de Bretagne, 3e</div>
          </div>
          <div class="score-badge">
            <div class="score-num">91</div>
            <div class="score-label">/100</div>
          </div>
        </div>
        <div class="score-bar-wrap">
          <div class="score-bar-track"><div class="score-bar-fill" style="width:91%"></div></div>
          <div class="score-pct">91%</div>
        </div>
        <div class="bar-meta">
          <div class="bar-meta-item">üìç Paris 3e</div>
          <div class="bar-meta-item">üïê Ouvert</div>
          <div class="bar-meta-item">üë• ~60 pers.</div>
        </div>
        <div class="certif-pills">
          <div class="certif-pill">‚úì Extincteurs</div>
          <div class="certif-pill">‚úì Issues secours</div>
          <div class="certif-pill">‚úì D√©tecteurs</div>
        </div>
      </div>

      <!-- Paris 2 ‚Äî Oberkampf -->
      <div class="bar-card" style="border-color:rgba(255,140,0,0.2);" data-idx="4" onclick="openModal(4)">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--orange);border-radius:0 2px 2px 0;"></div>
        <div style="position:absolute;top:10px;right:10px;background:rgba(232,184,75,0.12);border:1px solid rgba(232,184,75,0.3);color:#E8B84B;font-size:8px;font-weight:700;padding:2px 7px;border-radius:100px;">üóº Paris</div>
        <div class="bar-card-top" style="padding-right:60px;">
          <div>
            <div class="bar-name">Caf√© Oberkampf</div>
            <div class="bar-type">Bar concert ‚Äî 3 Rue Oberkampf, 11e</div>
          </div>
          <div class="score-badge orange">
            <div class="score-num orange">74</div>
            <div class="score-label">/100</div>
          </div>
        </div>
        <div class="score-bar-wrap">
          <div class="score-bar-track"><div class="score-bar-fill orange" style="width:74%"></div></div>
          <div class="score-pct">74%</div>
        </div>
        <div class="bar-meta">
          <div class="bar-meta-item">üìç Paris 11e</div>
          <div class="bar-meta-item">üïê Ouvert</div>
          <div class="bar-meta-item">üë• ~150 pers.</div>
        </div>
        <div class="certif-pills">
          <div class="certif-pill">‚úì Extincteurs</div>
          <div class="certif-pill warning">‚ö† Issues secours</div>
          <div class="certif-pill warning">‚ö† Registre</div>
        </div>
      </div>

      <!-- Paris 3 ‚Äî R√©publique -->
      <div class="bar-card" data-idx="5" onclick="openModal(5)">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:#E8B84B;border-radius:0 2px 2px 0;"></div>
        <div style="position:absolute;top:10px;right:10px;background:rgba(232,184,75,0.12);border:1px solid rgba(232,184,75,0.3);color:#E8B84B;font-size:8px;font-weight:700;padding:2px 7px;border-radius:100px;">üóº Paris</div>
        <div class="bar-card-top" style="padding-right:60px;">
          <div>
            <div class="bar-name">Bar R√©publique</div>
            <div class="bar-type">Brasserie ‚Äî 42 Bd du Temple, 3e</div>
          </div>
          <div class="score-badge">
            <div class="score-num">88</div>
            <div class="score-label">/100</div>
          </div>
        </div>
        <div class="score-bar-wrap">
          <div class="score-bar-track"><div class="score-bar-fill" style="width:88%"></div></div>
          <div class="score-pct">88%</div>
        </div>
        <div class="bar-meta">
          <div class="bar-meta-item">üìç Paris 3e</div>
          <div class="bar-meta-item">üïê Ouvert</div>
          <div class="bar-meta-item">üë• ~200 pers.</div>
        </div>
        <div class="certif-pills">
          <div class="certif-pill">‚úì Extincteurs</div>
          <div class="certif-pill">‚úì Issues secours</div>
          <div class="certif-pill">‚úì √âclairage</div>
        </div>
      </div>

      <!-- Paris 4 ‚Äî Bastille -->
      <div class="bar-card" style="border-color:rgba(255,140,0,0.2);" data-idx="6" onclick="openModal(6)">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--orange);border-radius:0 2px 2px 0;"></div>
        <div style="position:absolute;top:10px;right:10px;background:rgba(232,184,75,0.12);border:1px solid rgba(232,184,75,0.3);color:#E8B84B;font-size:8px;font-weight:700;padding:2px 7px;border-radius:100px;">üóº Paris</div>
        <div class="bar-card-top" style="padding-right:60px;">
          <div>
            <div class="bar-name">La Sc√®ne Bastille</div>
            <div class="bar-type">Bar PMU ‚Äî 7 Rue de la Roquette, 11e</div>
          </div>
          <div class="score-badge orange">
            <div class="score-num orange">71</div>
            <div class="score-label">/100</div>
          </div>
        </div>
        <div class="score-bar-wrap">
          <div class="score-bar-track"><div class="score-bar-fill orange" style="width:71%"></div></div>
          <div class="score-pct">71%</div>
        </div>
        <div class="bar-meta">
          <div class="bar-meta-item">üìç Paris 11e</div>
          <div class="bar-meta-item">üïê Ferm√©</div>
          <div class="bar-meta-item">üë• ~90 pers.</div>
        </div>
        <div class="certif-pills">
          <div class="certif-pill">‚úì Extincteurs</div>
          <div class="certif-pill warning">‚ö† D√©tecteurs</div>
          <div class="certif-pill warning">‚ö† √âclairage</div>
        </div>
      </div>

    </div>

    <!-- MODAL DETAIL -->
    <div class="modal-overlay" id="detailModal" onclick="closeModal(event)">
      <div class="modal-sheet" id="modalContent">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
          <div class="modal-handle" style="margin:0;"></div>
          <button onclick="closeModal()" style="background:rgba(255,255,255,0.08);border:none;color:var(--text);font-size:13px;padding:6px 14px;border-radius:10px;cursor:pointer;">‚úï Fermer</button>
        </div>
        <div class="modal-bar-name" id="modalName">‚Äì</div>
        <div class="modal-bar-addr" id="modalAddr">‚Äì</div>
        <div class="modal-score-big">
          <div class="modal-score-num" id="modalScore">‚Äì</div>
          <div class="modal-score-info">
            <div class="modal-score-label">Score de s√©curit√© ERP</div>
            <div class="modal-score-bar-track">
              <div class="modal-score-bar-fill" id="modalBar" style="width:0%"></div>
            </div>
          </div>
        </div>
        <div class="modal-section-title">D√©tails du certificat</div>
        <div class="modal-detail-grid" id="modalGrid"></div>
        <button class="modal-cta" onclick="navigate()">
          üó∫Ô∏è Y aller
        </button>
        <button class="modal-cta" style="background:var(--card);color:var(--text);border:1px solid var(--border);margin-top:10px;" onclick="showToast('‚≠ê Ajout√© √† vos favoris !')">
          ‚≠ê Sauvegarder
        </button>
        <button class="modal-cta" style="background:transparent;color:var(--muted);border:none;margin-top:6px;font-size:14px;" onclick="closeModal()">
          ‚Üê Retour √† la carte
        </button>
      </div>
    </div>

  </div>

  <!-- ‚îÄ‚îÄ CLIENT SUB-SCREENS ‚îÄ‚îÄ -->

  <!-- CARTE (d√©j√† affich√©e via client-header + map + bars-list = vue par d√©faut) -->
  <div id="clientSubMap" class="client-sub active"></div>

  <!-- FAVORIS -->
  <div id="clientSubFavorites" class="client-sub" style="display:none;padding:0 24px 100px;">
    <div style="padding:16px 0 12px;display:flex;justify-content:space-between;align-items:center;">
      <div class="section-title" style="margin:0;">Mes favoris</div>
      <div style="font-size:11px;color:var(--muted);" id="favCount">0 bar</div>
    </div>
    <div id="favList"></div>
    <div id="favEmpty" style="text-align:center;padding:60px 0;color:var(--muted);">
      <div style="font-size:48px;margin-bottom:12px;">‚≠ê</div>
      <div style="font-size:14px;font-weight:600;color:var(--text);margin-bottom:6px;">Aucun favori</div>
      <div style="font-size:12px;">Appuyez sur ‚≠ê dans la fiche d'un bar pour le sauvegarder</div>
    </div>
  </div>

  <!-- RECHERCHE -->
  <div id="clientSubSearch" class="client-sub" style="display:none;padding:0 24px 100px;">
    <div style="padding:16px 0 12px;">
      <div class="section-title" style="margin:0 0 12px;">Rechercher</div>
      <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input type="text" id="clientSearchInput" placeholder="Nom, adresse, ville‚Ä¶" oninput="doClientSearch()" style="font-size:14px;">
      </div>
      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;" id="searchFilters">
        <div class="filter-pill active" onclick="setSearchFilter('tous',this)">Tous</div>
        <div class="filter-pill" onclick="setSearchFilter('top',this)">Score > 85</div>
        <div class="filter-pill" onclick="setSearchFilter('tours',this)">Tours</div>
        <div class="filter-pill" onclick="setSearchFilter('paris',this)">Paris</div>
      </div>
    </div>
    <div id="searchResults"></div>
    <div id="searchEmpty" style="text-align:center;padding:40px 0;color:var(--muted);display:none;">
      <div style="font-size:36px;margin-bottom:10px;">üîç</div>
      <div style="font-size:13px;">Aucun r√©sultat pour cette recherche</div>
    </div>
  </div>

  <!-- PROFIL -->
  <div id="clientSubProfile" class="client-sub" style="display:none;padding:0 24px 100px;">
    <div style="padding:16px 0 20px;">
      <div class="section-title" style="margin:0 0 4px;">Mon profil</div>
      <div style="font-size:12px;color:var(--muted);">Utilisateur Spotafe</div>
    </div>
    <!-- Avatar -->
    <div style="text-align:center;margin-bottom:24px;">
      <div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,rgba(0,200,120,0.2),rgba(0,200,120,0.05));border:2px solid rgba(0,200,120,0.3);display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 10px;">üë§</div>
      <div style="font-size:15px;font-weight:700;color:var(--text);">Utilisateur</div>
      <div style="font-size:11px;color:var(--muted);margin-top:2px;">Membre depuis f√©v. 2026</div>
    </div>
    <!-- Stats perso -->
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:20px;">
      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;">
        <div style="font-size:22px;font-weight:900;color:var(--green);" id="profileFavCount">0</div>
        <div style="font-size:9px;color:var(--muted);margin-top:3px;">Favoris</div>
      </div>
      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;">
        <div style="font-size:22px;font-weight:900;color:var(--text);" id="profileScanCount">7</div>
        <div style="font-size:9px;color:var(--muted);margin-top:3px;">Fiches vues</div>
      </div>
      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;">
        <div style="font-size:22px;font-weight:900;color:#E8B84B;">84</div>
        <div style="font-size:9px;color:var(--muted);margin-top:3px;">Score moy.</div>
      </div>
    </div>
    <!-- Alertes -->
    <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">ALERTES VOISINAGE</div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:16px;" id="alertList">
      <div style="padding:14px 16px;border-bottom:1px solid var(--border);display:flex;gap:12px;align-items:flex-start;">
        <div style="font-size:18px;margin-top:2px;">üîî</div>
        <div>
          <div style="font-size:12px;font-weight:600;color:var(--text);">Le Vieux Murier a am√©lior√© son score</div>
          <div style="font-size:10px;color:var(--green);margin-top:2px;">+5 points ‚Üí 82/100 ¬∑ il y a 2 jours</div>
        </div>
      </div>
      <div style="padding:14px 16px;display:flex;gap:12px;align-items:flex-start;">
        <div style="font-size:18px;margin-top:2px;">‚ö†Ô∏è</div>
        <div>
          <div style="font-size:12px;font-weight:600;color:var(--text);">Caf√© Oberkampf : point en attente</div>
          <div style="font-size:10px;color:var(--orange);margin-top:2px;">Issues de secours ¬∑ il y a 5 jours</div>
        </div>
      </div>
    </div>
    <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">PARAM√àTRES</div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;">
      <div onclick="showToast('üîî Notifications activ√©es')" style="display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;">
        <span style="font-size:13px;color:var(--text);">Notifications de score</span>
        <span style="font-size:11px;color:var(--green);font-weight:700;">Activ√©es</span>
      </div>
      <div onclick="showToast('üìç Rayon mis √† jour')" style="display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer;">
        <span style="font-size:13px;color:var(--text);">Rayon d'alerte</span>
        <span style="font-size:11px;color:var(--muted);">500m ‚Ä∫</span>
      </div>
    </div>
  </div>


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PARENT SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="parent">
    <div class="client-header" style="padding-bottom:8px;">
      <div class="header-top">
        <div class="app-logo-small"><span class="s">S</span><span class="pot">pot</span><span class="afe">afe</span></div>
        <div class="back-btn" onclick="goTo('splash')">‚Üê Retour</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;margin-top:4px;">
        <div class="section-title" style="margin:0;">Je suis parent</div>
        <div style="background:rgba(160,100,255,0.15);border:1px solid rgba(160,100,255,0.35);color:#A064FF;font-size:9px;font-weight:700;padding:3px 8px;border-radius:100px;letter-spacing:.04em;">üîí CONSENTEMENT REQUIS</div>
      </div>
      <div style="font-size:12px;color:var(--muted);margin-top:3px;">Suivi activ√© uniquement avec l'accord de votre enfant</div>
    </div>

    <!-- ONGLETS PARENT -->
    <div style="display:flex;border-bottom:1px solid var(--border);margin:0 24px 0;">
      <div id="ptab-live" onclick="switchParentTab('live')" style="flex:1;padding:10px 0;text-align:center;font-size:12px;font-weight:700;color:#A064FF;border-bottom:2px solid #A064FF;cursor:pointer;">üìç En direct</div>
      <div id="ptab-history" onclick="switchParentTab('history')" style="flex:1;padding:10px 0;text-align:center;font-size:12px;font-weight:600;color:var(--muted);border-bottom:2px solid transparent;cursor:pointer;">üïê Historique</div>
      <div id="ptab-settings" onclick="switchParentTab('settings')" style="flex:1;padding:10px 0;text-align:center;font-size:12px;font-weight:600;color:var(--muted);border-bottom:2px solid transparent;cursor:pointer;">‚öôÔ∏è R√©glages</div>
    </div>

    <!-- SUB : EN DIRECT -->
    <div id="psub-live" style="padding:16px 24px 100px;">

      <!-- Profil enfant -->
      <div style="display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:16px;">
        <div style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,rgba(160,100,255,0.25),rgba(160,100,255,0.05));border:2px solid rgba(160,100,255,0.4);display:flex;align-items:center;justify-content:center;font-size:22px;">üßë</div>
        <div style="flex:1;">
          <div style="font-size:14px;font-weight:700;color:var(--text);">L√©a</div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px;">Mis √† jour il y a <span id="lastUpdate">2 min</span></div>
        </div>
        <div style="text-align:right;">
          <div id="childOnline" style="display:flex;align-items:center;gap:5px;justify-content:flex-end;">
            <div style="width:7px;height:7px;border-radius:50%;background:#00C878;animation:pulse-dot 1.5s infinite;"></div>
            <span style="font-size:11px;color:var(--green);font-weight:700;">En ligne</span>
          </div>
          <div style="font-size:10px;color:var(--muted);margin-top:3px;">Batterie 78%</div>
        </div>
      </div>

      <!-- Statut s√©curit√© -->
      <div id="safetyCard" style="border-radius:16px;padding:18px;margin-bottom:16px;background:linear-gradient(135deg,rgba(0,200,120,0.12),rgba(0,200,120,0.04));border:1px solid rgba(0,200,120,0.35);">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
          <div style="font-size:32px;" id="safetyIcon">‚úÖ</div>
          <div>
            <div style="font-size:13px;font-weight:800;color:var(--green);" id="safetyTitle">LIEU S√âCURIS√â</div>
            <div style="font-size:11px;color:var(--muted);margin-top:2px;" id="safetySubtitle">Score Spotafe ‚â• 85/100 ¬∑ V√©rifi√©</div>
          </div>
          <div style="margin-left:auto;text-align:center;">
            <div style="font-size:26px;font-weight:900;" id="safetyScore" class="kpi-green">91</div>
            <div style="font-size:8px;color:var(--muted);">/100</div>
          </div>
        </div>
        <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:10px 12px;">
          <div style="font-size:12px;font-weight:700;color:var(--text);" id="currentVenue">üìç Le Marais Social Club</div>
          <div style="font-size:10px;color:var(--muted);margin-top:2px;" id="currentAddr">18 Rue de Bretagne, Paris 3e</div>
          <div style="display:flex;gap:12px;margin-top:8px;">
            <span style="font-size:10px;color:var(--green);">‚úì Extincteurs OK</span>
            <span style="font-size:10px;color:var(--green);">‚úì Issues OK</span>
            <span style="font-size:10px;color:var(--green);">‚úì D√©tecteurs OK</span>
          </div>
        </div>
      </div>

      <!-- Mini carte -->
      <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:16px;">
        <canvas id="parentMapCanvas" width="320" height="140" style="width:100%;height:140px;display:block;"></canvas>
        <div style="padding:10px 14px;display:flex;justify-content:space-between;align-items:center;">
          <div style="font-size:11px;color:var(--muted);">Paris 3e ¬∑ Rue de Bretagne</div>
          <div onclick="showToast('üó∫Ô∏è Navigation lanc√©e')" style="background:rgba(160,100,255,0.15);border:1px solid rgba(160,100,255,0.3);color:#A064FF;font-size:10px;font-weight:700;padding:5px 12px;border-radius:100px;cursor:pointer;">Y aller ‚Ä∫</div>
        </div>
      </div>

      <!-- Actions rapides -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">
        <div onclick="showToast('üì± Message envoy√© √† L√©a')" style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;cursor:pointer;">
          <div style="font-size:22px;margin-bottom:6px;">üí¨</div>
          <div style="font-size:11px;font-weight:700;color:var(--text);">Envoyer message</div>
        </div>
        <div onclick="showToast('üìû Appel lanc√© vers L√©a')" style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;cursor:pointer;">
          <div style="font-size:22px;margin-bottom:6px;">üìû</div>
          <div style="font-size:11px;font-weight:700;color:var(--text);">Appeler</div>
        </div>
      </div>

      <!-- Simulateur : changer le lieu -->
      <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">SIMULER UN D√âPLACEMENT</div>
      <div style="display:flex;flex-direction:column;gap:8px;">
        <div onclick="simulateLocation(0)" class="sim-loc-btn" style="background:var(--card);border:1px solid rgba(0,200,120,0.3);border-radius:12px;padding:12px 14px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;">
          <div><div style="font-size:12px;font-weight:700;color:var(--text);">Le Marais Social Club ¬∑ Paris 3e</div><div style="font-size:10px;color:var(--green);margin-top:2px;">Score 91/100 ‚úÖ S√©curis√©</div></div>
          <div style="font-size:16px;">‚Ä∫</div>
        </div>
        <div onclick="simulateLocation(1)" class="sim-loc-btn" style="background:var(--card);border:1px solid rgba(255,140,0,0.3);border-radius:12px;padding:12px 14px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;">
          <div><div style="font-size:12px;font-weight:700;color:var(--text);">Caf√© Oberkampf ¬∑ Paris 11e</div><div style="font-size:10px;color:var(--orange);margin-top:2px;">Score 74/100 ‚ö†Ô∏è Non certifi√©</div></div>
          <div style="font-size:16px;">‚Ä∫</div>
        </div>
        <div onclick="simulateLocation(2)" class="sim-loc-btn" style="background:var(--card);border:1px solid rgba(0,200,120,0.3);border-radius:12px;padding:12px 14px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;">
          <div><div style="font-size:12px;font-weight:700;color:var(--text);">La Guinguette ¬∑ Tours</div><div style="font-size:10px;color:var(--green);margin-top:2px;">Score 85/100 ‚úÖ S√©curis√©</div></div>
          <div style="font-size:16px;">‚Ä∫</div>
        </div>
      </div>
    </div>

    <!-- SUB : HISTORIQUE -->
    <div id="psub-history" style="display:none;padding:16px 24px 100px;">
      <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:12px;">LIEUX VISIT√âS ‚Äî 7 DERNIERS JOURS</div>
      <div style="display:flex;flex-direction:column;gap:2px;">

        <div style="font-size:10px;color:var(--muted);font-weight:700;padding:8px 0 4px;letter-spacing:.04em;">AUJOURD'HUI</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:13px 14px;display:flex;gap:12px;align-items:center;">
          <div style="width:36px;height:36px;border-radius:10px;background:rgba(0,200,120,0.12);border:1px solid rgba(0,200,120,0.3);display:flex;align-items:center;justify-content:center;font-size:16px;">‚úÖ</div>
          <div style="flex:1;">
            <div style="font-size:12px;font-weight:700;color:var(--text);">Le Marais Social Club</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px;">Paris 3e ¬∑ 22h14 ‚Üí En cours ¬∑ Score 91</div>
          </div>
          <div style="font-size:13px;font-weight:900;color:var(--green);">91</div>
        </div>

        <div style="font-size:10px;color:var(--muted);font-weight:700;padding:12px 0 4px;letter-spacing:.04em;">HIER</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:13px 14px;display:flex;gap:12px;align-items:center;margin-bottom:2px;">
          <div style="width:36px;height:36px;border-radius:10px;background:rgba(255,140,0,0.1);border:1px solid rgba(255,140,0,0.3);display:flex;align-items:center;justify-content:center;font-size:16px;">‚ö†Ô∏è</div>
          <div style="flex:1;">
            <div style="font-size:12px;font-weight:700;color:var(--text);">Caf√© Oberkampf</div>
            <div style="font-size:10px;color:var(--orange);margin-top:2px;">Paris 11e ¬∑ 21h02‚Üí23h45 ¬∑ Score 74 ‚ö†Ô∏è</div>
          </div>
          <div style="font-size:13px;font-weight:900;color:var(--orange);">74</div>
        </div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:13px 14px;display:flex;gap:12px;align-items:center;">
          <div style="width:36px;height:36px;border-radius:10px;background:rgba(0,200,120,0.12);border:1px solid rgba(0,200,120,0.3);display:flex;align-items:center;justify-content:center;font-size:16px;">‚úÖ</div>
          <div style="flex:1;">
            <div style="font-size:12px;font-weight:700;color:var(--text);">Bar R√©publique</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px;">Paris 3e ¬∑ 18h30‚Üí20h15 ¬∑ Score 88</div>
          </div>
          <div style="font-size:13px;font-weight:900;color:var(--green);">88</div>
        </div>

        <div style="font-size:10px;color:var(--muted);font-weight:700;padding:12px 0 4px;letter-spacing:.04em;">VENDREDI 14 F√âV.</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:13px 14px;display:flex;gap:12px;align-items:center;">
          <div style="width:36px;height:36px;border-radius:10px;background:rgba(0,200,120,0.12);border:1px solid rgba(0,200,120,0.3);display:flex;align-items:center;justify-content:center;font-size:16px;">‚úÖ</div>
          <div style="flex:1;">
            <div style="font-size:12px;font-weight:700;color:var(--text);">Le Vieux Murier</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px;">Tours ¬∑ 20h00‚Üí01h30 ¬∑ Score 82</div>
          </div>
          <div style="font-size:13px;font-weight:900;color:var(--green);">82</div>
        </div>

        <!-- R√©sum√© semaine -->
        <div style="margin-top:16px;background:rgba(160,100,255,0.08);border:1px solid rgba(160,100,255,0.2);border-radius:12px;padding:14px;">
          <div style="font-size:11px;color:#A064FF;font-weight:700;margin-bottom:8px;">üìä R√âSUM√â DE LA SEMAINE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;text-align:center;">
            <div><div style="font-size:20px;font-weight:900;color:var(--green);">3</div><div style="font-size:9px;color:var(--muted);">Lieux s√©curis√©s</div></div>
            <div><div style="font-size:20px;font-weight:900;color:var(--orange);">1</div><div style="font-size:9px;color:var(--muted);">√Ä surveiller</div></div>
            <div><div style="font-size:20px;font-weight:900;color:var(--text);">84</div><div style="font-size:9px;color:var(--muted);">Score moyen</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- SUB : R√âGLAGES -->
    <div id="psub-settings" style="display:none;padding:16px 24px 100px;">
      <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:12px;">PROFIL SUIVI</div>
      <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:16px;">
        <div style="padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
          <div><div style="font-size:13px;font-weight:700;color:var(--text);">L√©a</div><div style="font-size:10px;color:var(--muted);">Consentement donn√© le 12/02/2026</div></div>
          <div style="background:rgba(0,200,120,0.12);border:1px solid rgba(0,200,120,0.3);color:var(--green);font-size:9px;font-weight:700;padding:4px 8px;border-radius:100px;">‚úì Actif</div>
        </div>
        <div onclick="showToast('üì± Lien envoy√© √† L√©a')" style="padding:14px 16px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;">
          <span style="font-size:13px;color:var(--text);">Ajouter un autre enfant</span>
          <span style="font-size:16px;color:var(--muted);">+</span>
        </div>
      </div>

      <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:12px;">ALERTES</div>
      <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:16px;">
        <div onclick="showToast('‚öôÔ∏è Seuil mis √† jour')" style="display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;">
          <div>
            <div style="font-size:13px;color:var(--text);">Alerte si lieu non certifi√©</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px;">Score &lt; 85/100</div>
          </div>
          <div style="background:rgba(0,200,120,0.12);border:1px solid rgba(0,200,120,0.3);color:var(--green);font-size:9px;font-weight:700;padding:4px 8px;border-radius:100px;">Activ√©e</div>
        </div>
        <div onclick="showToast('‚öôÔ∏è Param√®tre mis √† jour')" style="display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;">
          <div>
            <div style="font-size:13px;color:var(--text);">Notification d'arriv√©e</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px;">Quand l'enfant entre dans un ERP</div>
          </div>
          <div style="background:rgba(0,200,120,0.12);border:1px solid rgba(0,200,120,0.3);color:var(--green);font-size:9px;font-weight:700;padding:4px 8px;border-radius:100px;">Activ√©e</div>
        </div>
        <div onclick="showToast('‚öôÔ∏è Heure de retour mise √† jour')" style="display:flex;justify-content:space-between;align-items:center;padding:14px 16px;cursor:pointer;">
          <div>
            <div style="font-size:13px;color:var(--text);">Heure de retour attendue</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px;">Alerte si d√©pass√©e</div>
          </div>
          <span style="font-size:12px;color:var(--muted);">01h00 ‚Ä∫</span>
        </div>
      </div>

      <!-- Consentement info -->
      <div style="background:rgba(160,100,255,0.08);border:1px solid rgba(160,100,255,0.2);border-radius:12px;padding:14px 16px;">
        <div style="font-size:11px;color:#A064FF;font-weight:700;margin-bottom:6px;">üîí RESPECT DE LA VIE PRIV√âE</div>
        <div style="font-size:11px;color:var(--muted);line-height:1.6;">Le suivi est <strong style="color:var(--text);">toujours soumis au consentement explicite</strong> de l'enfant. Il peut le d√©sactiver √† tout moment depuis son profil. La localisation n'est partag√©e qu'avec le parent autoris√©.</div>
      </div>
    </div>

    <!-- Tab bar parent -->
    <div class="tab-bar visible" id="tabParent">
      <div class="tab-item" onclick="switchParentTab('live')">
        <div class="tab-icon active" id="ptabLiveIcon">üìç</div>
        <div class="tab-txt active" id="ptabLiveTxt">En direct</div>
      </div>
      <div class="tab-item" onclick="switchParentTab('history')">
        <div class="tab-icon" id="ptabHistoryIcon">üïê</div>
        <div class="tab-txt" id="ptabHistoryTxt">Historique</div>
      </div>
      <div class="tab-item" onclick="switchParentTab('settings')">
        <div class="tab-icon" id="ptabSettingsIcon">‚öôÔ∏è</div>
        <div class="tab-txt" id="ptabSettingsTxt">R√©glages</div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BAR OWNER SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="barowner">

    <!-- SUB: ACCUEIL -->
    <div class="owner-sub active" id="ownerHome">
    <div class="bar-header">
      <div class="bar-header-top">
        <div class="app-logo-small"><span class="s">S</span><span class="pot">pot</span><span class="afe">afe</span></div>
        <div class="back-btn" onclick="goTo('splash')">‚Üê Retour</div>
      </div>
      <div class="establishment-name">Bar du Centre</div>
      <div class="establishment-sub">5 Rue Colbert ‚Ä¢ Tours ‚Ä¢ ERP Type N ‚Ä¢ 3e cat√©gorie</div>
    </div>

    <!-- BIG SCORE -->
    <div class="big-score-card">
      <div class="score-row">
        <div>
          <div class="score-label-main">Score global de s√©curit√©</div>
          <div style="display:flex;align-items:baseline;gap:4px;">
            <div class="big-score-num" id="animatedScore">0</div>
            <div class="big-score-denom">/100</div>
          </div>
          <div class="score-trend">‚Üë +3 pts ce trimestre</div>
        </div>
        <div class="score-ring">
          <svg width="90" height="90" viewBox="0 0 90 90">
            <circle class="ring-bg" cx="45" cy="45" r="36"/>
            <circle class="ring-fill" cx="45" cy="45" r="36"/>
          </svg>
          <div class="ring-label">78</div>
        </div>
      </div>
      <div class="score-bar-track" style="height:8px;">
        <div class="score-bar-fill orange" style="width:78%;height:100%;border-radius:4px;"></div>
      </div>
    </div>

    <!-- CRITERIA -->
    <div class="criteria-section">
      <div class="criteria-title">D√©tail par crit√®re</div>
      <div class="criteria-list">

        <div class="criteria-item">
          <div class="criteria-icon ci-green">üî•</div>
          <div class="criteria-info">
            <div class="criteria-name">Extincteurs & syst√®mes anti-incendie</div>
            <div class="criteria-bar-wrap">
              <div class="criteria-bar-track"><div class="criteria-bar-fill" style="width:95%"></div></div>
              <div class="criteria-pct">95%</div>
            </div>
          </div>
          <div class="criteria-status cs-ok">‚úì OK</div>
        </div>

        <div class="criteria-item">
          <div class="criteria-icon ci-orange">üö™</div>
          <div class="criteria-info">
            <div class="criteria-name">Issues de secours</div>
            <div class="criteria-bar-wrap">
              <div class="criteria-bar-track"><div class="criteria-bar-fill orange" style="width:70%"></div></div>
              <div class="criteria-pct">70%</div>
            </div>
          </div>
          <div class="criteria-status cs-warn">‚ö† Action</div>
        </div>

        <div class="criteria-item">
          <div class="criteria-icon ci-orange">üí°</div>
          <div class="criteria-info">
            <div class="criteria-name">√âclairage de s√©curit√©</div>
            <div class="criteria-bar-wrap">
              <div class="criteria-bar-track"><div class="criteria-bar-fill orange" style="width:65%"></div></div>
              <div class="criteria-pct">65%</div>
            </div>
          </div>
          <div class="criteria-status cs-warn">‚ö† Action</div>
        </div>

        <div class="criteria-item">
          <div class="criteria-icon ci-green">üìã</div>
          <div class="criteria-info">
            <div class="criteria-name">Affichages r√©glementaires</div>
            <div class="criteria-bar-wrap">
              <div class="criteria-bar-track"><div class="criteria-bar-fill" style="width:90%"></div></div>
              <div class="criteria-pct">90%</div>
            </div>
          </div>
          <div class="criteria-status cs-ok">‚úì OK</div>
        </div>

        <div class="criteria-item">
          <div class="criteria-icon ci-green">üèóÔ∏è</div>
          <div class="criteria-info">
            <div class="criteria-name">Structure & mat√©riaux</div>
            <div class="criteria-bar-wrap">
              <div class="criteria-bar-track"><div class="criteria-bar-fill" style="width:85%"></div></div>
              <div class="criteria-pct">85%</div>
            </div>
          </div>
          <div class="criteria-status cs-ok">‚úì OK</div>
        </div>

        <div class="criteria-item">
          <div class="criteria-icon ci-red">üîî</div>
          <div class="criteria-info">
            <div class="criteria-name">D√©tecteurs de fum√©e</div>
            <div class="criteria-bar-wrap">
              <div class="criteria-bar-track"><div class="criteria-bar-fill red" style="width:40%"></div></div>
              <div class="criteria-pct">40%</div>
            </div>
          </div>
          <div class="criteria-status cs-bad">‚úó Urgent</div>
        </div>

      </div>
    </div>

    <!-- ACTIONS -->
    <div class="actions-section">
      <div class="actions-title">Actions recommand√©es</div>

      <div class="action-btn" onclick="showToast('üìÖ Prise de rendez-vous ouverte')">
        <div class="action-btn-icon">üìÖ</div>
        <div class="action-btn-text">
          <div class="action-btn-title">Planifier une inspection</div>
          <div class="action-btn-sub">Prochaine visite recommand√©e : mars 2026</div>
        </div>
        <div class="action-btn-arrow">‚Ä∫</div>
      </div>

      <div class="action-btn" onclick="showToast('üì§ Rapport envoy√© √† la commission')">
        <div class="action-btn-icon orange">üì§</div>
        <div class="action-btn-text">
          <div class="action-btn-title">Envoyer mon dossier</div>
          <div class="action-btn-sub">Commission de s√©curit√© d'Indre-et-Loire</div>
        </div>
        <div class="action-btn-arrow">‚Ä∫</div>
      </div>

      <div class="action-btn" onclick="showToast('üìú Certificat t√©l√©charg√©')">
        <div class="action-btn-icon">üìú</div>
        <div class="action-btn-text">
          <div class="action-btn-title">T√©l√©charger mon certificat</div>
          <div class="action-btn-sub">Valide jusqu'au 12 septembre 2026</div>
        </div>
        <div class="action-btn-arrow">‚Ä∫</div>
      </div>

      <div class="action-btn" onclick="showToast('üëÅÔ∏è Aper√ßu de votre fiche publique')">
        <div class="action-btn-icon">üëÅÔ∏è</div>
        <div class="action-btn-text">
          <div class="action-btn-title">Voir ma fiche publique</div>
          <div class="action-btn-sub">Ce que voient vos clients sur Spotafe</div>
        </div>
        <div class="action-btn-arrow">‚Ä∫</div>
      </div>
    </div>

  </div>

  <!-- TAB BAR CLIENT -->
  <div class="tab-bar" id="tabClient">
    <div class="tab-item" onclick="switchClientTab('map')">
      <div class="tab-icon active" id="ctabMap">üó∫Ô∏è</div>
      <div class="tab-txt active" id="ctabMapTxt">Carte</div>
    </div>
    <div class="tab-item" onclick="switchClientTab('favorites')">
      <div class="tab-icon" id="ctabFavorites">‚≠ê</div>
      <div class="tab-txt" id="ctabFavoritesTxt">Favoris</div>
    </div>
    <div class="tab-item" onclick="switchClientTab('search')">
      <div class="tab-icon" id="ctabSearch">üîç</div>
      <div class="tab-txt" id="ctabSearchTxt">Chercher</div>
    </div>
    <div class="tab-item" onclick="switchClientTab('profile')">
      <div class="tab-icon" id="ctabProfile">üë§</div>
      <div class="tab-txt" id="ctabProfileTxt">Profil</div>
    </div>
  </div>

  <!-- TAB BAR BAR OWNER -->
  <div class="tab-bar" id="tabBar">
    <div class="tab-item" onclick="switchOwnerTab('home')">
      <div class="tab-icon active" id="ownerTabHome">üè†</div>
      <div class="tab-txt active" id="ownerTabHomeTxt">Accueil</div>
    </div>
    <div class="tab-item" onclick="switchOwnerTab('analytics')">
      <div class="tab-icon" id="ownerTabAnalytics">üìä</div>
      <div class="tab-txt" id="ownerTabAnalyticsTxt">Stats</div>
    </div>
    <div class="tab-item" onclick="switchOwnerTab('partners')">
      <div class="tab-icon" id="ownerTabPartners">ü§ù</div>
      <div class="tab-txt" id="ownerTabPartnersTxt">Partenaires</div>
    </div>
    <div class="tab-item" onclick="switchOwnerTab('docs')">
      <div class="tab-icon" id="ownerTabDocs">üìã</div>
      <div class="tab-txt" id="ownerTabDocsTxt">Documents</div>
    </div>
    <div class="tab-item" onclick="switchOwnerTab('settings')">
      <div class="tab-icon" id="ownerTabSettings">‚öôÔ∏è</div>
      <div class="tab-txt" id="ownerTabSettingsTxt">R√©glages</div>
    </div>
    </div><!-- /ownerHome -->

    <!-- SUB: PARTENAIRES -->
    <div class="owner-sub" id="ownerPartners">
      <div class="partners-screen active">
        <div style="padding-top:8px;" class="header-top">
          <div>
            <div class="section-title">Partenaires agr√©√©s</div>
            <div class="partners-count" id="partnersCount">7 organismes ‚Ä¢ Tours, Paris & France</div>
          </div>
          <div class="back-btn" onclick="switchOwnerTab('home')">‚Üê Retour</div>
        </div>

        <!-- SEARCH -->
        <div class="search-bar" style="margin-top:16px;">
          <span class="search-icon">üîç</span>
          <input type="text" id="partnerSearch" placeholder="Nom, ville, sp√©cialit√©‚Ä¶" oninput="filterPartners()">
        </div>

        <!-- FILTERS -->
        <div class="filter-pills">
          <div class="filter-pill active" onclick="setFilter('tous', this)">Tous</div>
          <div class="filter-pill" onclick="setFilter('bureau', this)">Bureau de contr√¥le</div>
          <div class="filter-pill" onclick="setFilter('securite', this)">S√©curit√© incendie</div>
          <div class="filter-pill" onclick="setFilter('erp', this)">Sp√©. ERP</div>
          <div class="filter-pill" onclick="setFilter('rapide', this)">Intervention rapide</div>
        </div>

        <!-- LISTE -->
        <div id="partnersList"></div>
      </div>
    </div><!-- /ownerPartners -->

    <!-- SUB: DOCUMENTS -->
    <div class="owner-sub" id="ownerDocs">
      <div style="padding:16px 24px 0;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
          <div class="section-title" style="margin:0;">Certificats & documents</div>
          <div class="back-btn" onclick="switchOwnerTab('home')">‚Üê Retour</div>
        </div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:20px;">Bar du Centre ‚Ä¢ Tours</div>
      </div>

      <!-- Certificat actif -->
      <div style="margin:0 24px 16px;">
        <div style="background:linear-gradient(135deg,rgba(0,200,120,0.1),rgba(0,200,120,0.04));border:1px solid rgba(0,200,120,0.3);border-radius:16px;padding:18px;">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;">
            <div>
              <div style="font-size:11px;color:var(--green);font-weight:700;letter-spacing:.06em;margin-bottom:4px;">‚úÖ CERTIFICAT ACTIF</div>
              <div style="font-size:15px;font-weight:700;color:var(--text);">Certificat de conformit√© ERP</div>
              <div style="font-size:11px;color:var(--muted);margin-top:2px;">D√©livr√© par Apave Centre-Val de Loire</div>
            </div>
            <div style="background:rgba(0,200,120,0.15);border-radius:10px;padding:8px 12px;text-align:center;">
              <div style="font-size:22px;font-weight:900;color:var(--green);line-height:1;">82</div>
              <div style="font-size:8px;color:var(--muted);">/100</div>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;">
            <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:8px 10px;">
              <div style="font-size:9px;color:var(--muted);margin-bottom:2px;">D√©livr√© le</div>
              <div style="font-size:11px;font-weight:600;color:var(--text);">14 juin 2025</div>
            </div>
            <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:8px 10px;">
              <div style="font-size:9px;color:var(--muted);margin-bottom:2px;">Valide jusqu'au</div>
              <div style="font-size:11px;font-weight:600;color:var(--text);">14 juin 2026</div>
            </div>
            <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:8px 10px;">
              <div style="font-size:9px;color:var(--muted);margin-bottom:2px;">R√©f√©rence</div>
              <div style="font-size:11px;font-weight:600;color:var(--text);">APV-2025-4471</div>
            </div>
            <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:8px 10px;">
              <div style="font-size:9px;color:var(--muted);margin-bottom:2px;">Cat√©gorie ERP</div>
              <div style="font-size:11px;font-weight:600;color:var(--text);">Type N ‚Äî 3e cat.</div>
            </div>
          </div>
          <div style="display:flex;gap:8px;">
            <button onclick="showToast('üì• Certificat t√©l√©charg√©')" style="flex:1;background:var(--green);color:#000;border:none;border-radius:10px;padding:10px;font-size:12px;font-weight:700;cursor:pointer;">üì• T√©l√©charger PDF</button>
            <button onclick="showToast('üì§ Certificat partag√©')" style="flex:1;background:var(--card);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px;font-size:12px;font-weight:600;cursor:pointer;">üì§ Partager</button>
          </div>
        </div>
      </div>

      <!-- Rapport de visite -->
      <div style="margin:0 24px 16px;">
        <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">RAPPORTS DE VISITE</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;">
          <div onclick="showToast('üìã Rapport ouvert')" style="display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;">
            <div style="font-size:22px;">üìÑ</div>
            <div style="flex:1;">
              <div style="font-size:12px;font-weight:600;color:var(--text);">Rapport visite Apave ‚Äî juin 2025</div>
              <div style="font-size:10px;color:var(--muted);margin-top:2px;">PDF ‚Ä¢ 3 pages ‚Ä¢ 245 Ko</div>
            </div>
            <div style="color:var(--muted);font-size:16px;">‚Ä∫</div>
          </div>
          <div onclick="showToast('üìã Rapport ouvert')" style="display:flex;align-items:center;gap:12px;padding:14px 16px;cursor:pointer;">
            <div style="font-size:22px;">üìÑ</div>
            <div style="flex:1;">
              <div style="font-size:12px;font-weight:600;color:var(--text);">Rapport visite Apave ‚Äî juin 2024</div>
              <div style="font-size:10px;color:var(--muted);margin-top:2px;">PDF ‚Ä¢ 3 pages ‚Ä¢ 218 Ko</div>
            </div>
            <div style="color:var(--muted);font-size:16px;">‚Ä∫</div>
          </div>
        </div>
      </div>

      <!-- Prochain renouvellement -->
      <div style="margin:0 24px 100px;">
        <div style="background:rgba(255,140,0,0.08);border:1px solid rgba(255,140,0,0.25);border-radius:12px;padding:14px 16px;display:flex;align-items:center;gap:12px;">
          <div style="font-size:24px;">‚è∞</div>
          <div>
            <div style="font-size:12px;font-weight:700;color:var(--orange);">Renouvellement dans 4 mois</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px;">Planifier une visite Apave avant le 14 juin 2026</div>
          </div>
        </div>
      </div>
    </div>

    <!-- SUB: ANALYTICS -->
    <div class="owner-sub" id="ownerAnalytics">
      <div style="padding:16px 24px 0;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
          <div class="section-title" style="margin:0;">Statistiques de consultation</div>
          <div class="back-btn" onclick="switchOwnerTab('home')">‚Üê Retour</div>
        </div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:16px;">Bar du Centre ‚Ä¢ Tours ‚Äî 30 derniers jours</div>
      </div>

      <!-- KPIs -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 24px 16px;">
        <div style="background:linear-gradient(135deg,rgba(0,200,120,0.12),rgba(0,200,120,0.04));border:1px solid rgba(0,200,120,0.25);border-radius:14px;padding:14px;">
          <div style="font-size:10px;color:var(--green);font-weight:700;letter-spacing:.05em;margin-bottom:6px;">VUES FICHE</div>
          <div style="font-size:28px;font-weight:900;color:var(--text);line-height:1;" class="kpi-vues">847</div>
          <div style="font-size:10px;color:var(--green);margin-top:4px;">‚Üë +23% vs mois pr√©c.</div>
        </div>
        <div style="background:linear-gradient(135deg,rgba(232,184,75,0.12),rgba(232,184,75,0.04));border:1px solid rgba(232,184,75,0.25);border-radius:14px;padding:14px;">
          <div style="font-size:10px;color:var(--gold, #E8B84B);font-weight:700;letter-spacing:.05em;margin-bottom:6px;">SCANS QR</div>
          <div style="font-size:28px;font-weight:900;color:var(--text);line-height:1;" class="kpi-scans">134</div>
          <div style="font-size:10px;color:var(--gold, #E8B84B);margin-top:4px;">‚Üë +41% vs mois pr√©c.</div>
        </div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;">
          <div style="font-size:10px;color:var(--muted);font-weight:700;letter-spacing:.05em;margin-bottom:6px;">SCORE MOYEN VU</div>
          <div style="font-size:28px;font-weight:900;color:var(--text);line-height:1;">82<span style="font-size:14px;color:var(--muted)">/100</span></div>
          <div style="font-size:10px;color:var(--muted);margin-top:4px;">Stable ce mois</div>
        </div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;">
          <div style="font-size:10px;color:var(--muted);font-weight:700;letter-spacing:.05em;margin-bottom:6px;">CLASSEMENT LOCAL</div>
          <div style="font-size:28px;font-weight:900;color:var(--text);line-height:1;">#2<span style="font-size:14px;color:var(--muted)">/7</span></div>
          <div style="font-size:10px;color:var(--muted);margin-top:4px;">Bars du centre-ville</div>
        </div>
      </div>

      <!-- Graphe visites 30j -->
      <div style="margin:0 24px 16px;">
        <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">VISITES PAR JOUR ‚Äî 30 DERNIERS JOURS</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;">
          <canvas id="analyticsChart" width="270" height="100" style="width:100%;height:100px;"></canvas>
        </div>
      </div>

      <!-- S√©lecteur p√©riode -->
      <div style="padding:0 24px;margin-bottom:16px;display:flex;gap:8px;">
        <div id="period7"  onclick="setPeriod(7)"  style="background:var(--card);border:1px solid var(--border);border-radius:100px;padding:5px 12px;font-size:11px;color:var(--muted);cursor:pointer;">7j</div>
        <div id="period30" onclick="setPeriod(30)" style="background:rgba(0,200,120,0.15);border:1px solid rgba(0,200,120,0.4);border-radius:100px;padding:5px 12px;font-size:11px;color:var(--green);font-weight:700;cursor:pointer;">30j</div>
        <div id="period90" onclick="setPeriod(90)" style="background:var(--card);border:1px solid var(--border);border-radius:100px;padding:5px 12px;font-size:11px;color:var(--muted);cursor:pointer;">90j</div>
      </div>

      <!-- Sources de trafic -->
      <div style="margin:0 24px 16px;">
        <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">SOURCES DE CONSULTATION</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;">
          <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;">
            <div style="font-size:18px;">üì±</div>
            <div style="flex:1;">
              <div style="display:flex;justify-content:space-between;margin-bottom:5px;">
                <span style="font-size:12px;font-weight:600;color:var(--text);">Application Spotafe</span>
                <span style="font-size:12px;font-weight:700;color:var(--green);">58%</span>
              </div>
              <div style="background:var(--border);border-radius:4px;height:4px;"><div style="width:58%;height:100%;background:var(--green);border-radius:4px;"></div></div>
            </div>
          </div>
          <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;">
            <div style="font-size:18px;">üî∑</div>
            <div style="flex:1;">
              <div style="display:flex;justify-content:space-between;margin-bottom:5px;">
                <span style="font-size:12px;font-weight:600;color:var(--text);">Scan QR badge vitrine</span>
                <span style="font-size:12px;font-weight:700;color:#E8B84B;">16%</span>
              </div>
              <div style="background:var(--border);border-radius:4px;height:4px;"><div style="width:16%;height:100%;background:#E8B84B;border-radius:4px;"></div></div>
            </div>
          </div>
          <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;">
            <div style="font-size:18px;">üó∫Ô∏è</div>
            <div style="flex:1;">
              <div style="display:flex;justify-content:space-between;margin-bottom:5px;">
                <span style="font-size:12px;font-weight:600;color:var(--text);">Google Maps</span>
                <span style="font-size:12px;font-weight:700;color:#3B9EFF;">18%</span>
              </div>
              <div style="background:var(--border);border-radius:4px;height:4px;"><div style="width:18%;height:100%;background:#3B9EFF;border-radius:4px;"></div></div>
            </div>
          </div>
          <div style="padding:12px 16px;display:flex;align-items:center;gap:12px;">
            <div style="font-size:18px;">üåê</div>
            <div style="flex:1;">
              <div style="display:flex;justify-content:space-between;margin-bottom:5px;">
                <span style="font-size:12px;font-weight:600;color:var(--text);">Recherche web directe</span>
                <span style="font-size:12px;font-weight:700;color:var(--muted);">8%</span>
              </div>
              <div style="background:var(--border);border-radius:4px;height:4px;"><div style="width:8%;height:100%;background:var(--muted);border-radius:4px;"></div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Conseil -->
      <div style="margin:0 24px 100px;">
        <div style="background:rgba(0,200,120,0.06);border:1px solid rgba(0,200,120,0.2);border-radius:12px;padding:14px 16px;">
          <div style="font-size:11px;color:var(--green);font-weight:700;margin-bottom:6px;">üí° CONSEIL SPOTAFE</div>
          <div style="font-size:11px;color:var(--muted);line-height:1.6;">Votre score de 82/100 vous place dans le <strong style="color:var(--text);">top 30%</strong> des bars de Tours. Corriger le point "D√©tecteurs fum√©e" vous ferait gagner <strong style="color:var(--green);">+8 points</strong> et passer en top 10%.</div>
        </div>
      </div>

      <!-- Comparatif concurrents -->
      <div style="margin:0 24px 16px;">
        <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">COMPARATIF ‚Äî VOS 3 CONCURRENTS LES PLUS PROCHES</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;">
          <!-- Vous -->
          <div style="padding:12px 16px;border-bottom:1px solid var(--border);background:rgba(0,200,120,0.05);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
              <span style="font-size:12px;font-weight:700;color:var(--green);">üìç Vous ‚Äî Bar du Centre</span>
              <span style="font-size:14px;font-weight:900;color:var(--green);">82</span>
            </div>
            <div style="background:var(--border);border-radius:4px;height:5px;"><div style="width:82%;height:100%;background:var(--green);border-radius:4px;"></div></div>
          </div>
          <!-- Concurrent 1 -->
          <div style="padding:12px 16px;border-bottom:1px solid var(--border);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
              <span style="font-size:12px;font-weight:600;color:var(--text);">Le Vieux Murier <span style="color:var(--muted);font-size:10px;">¬∑ 170m</span></span>
              <span style="font-size:14px;font-weight:900;color:var(--text);">82</span>
            </div>
            <div style="background:var(--border);border-radius:4px;height:5px;"><div style="width:82%;height:100%;background:rgba(255,255,255,0.3);border-radius:4px;"></div></div>
          </div>
          <!-- Concurrent 2 -->
          <div style="padding:12px 16px;border-bottom:1px solid var(--border);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
              <span style="font-size:12px;font-weight:600;color:var(--text);">La Guinguette <span style="color:var(--muted);font-size:10px;">¬∑ 330m</span></span>
              <span style="font-size:14px;font-weight:900;color:var(--green);">85 ‚Üë</span>
            </div>
            <div style="background:var(--border);border-radius:4px;height:5px;"><div style="width:85%;height:100%;background:var(--green);border-radius:4px;"></div></div>
          </div>
          <!-- Concurrent 3 -->
          <div style="padding:12px 16px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
              <span style="font-size:12px;font-weight:600;color:var(--text);">Le Petit Zinc <span style="color:var(--muted);font-size:10px;">¬∑ 420m</span></span>
              <span style="font-size:14px;font-weight:900;color:var(--orange);">71</span>
            </div>
            <div style="background:var(--border);border-radius:4px;height:5px;"><div style="width:71%;height:100%;background:var(--orange);border-radius:4px;"></div></div>
          </div>
        </div>
      </div>

      <!-- Score historique 12 mois -->
      <div style="margin:0 24px 16px;">
        <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">√âVOLUTION DU SCORE ‚Äî 12 DERNIERS MOIS</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;">
          <canvas id="scoreHistoryChart" width="270" height="80" style="width:100%;height:80px;"></canvas>
          <div style="display:flex;justify-content:space-between;margin-top:8px;">
            <span style="font-size:9px;color:var(--muted);">F√©v 2025</span>
            <span style="font-size:9px;color:var(--muted);">Ao√ªt 2025</span>
            <span style="font-size:9px;color:var(--green);font-weight:700;">F√©v 2026</span>
          </div>
        </div>
      </div>

      <!-- Export rapport -->
      <div style="margin:0 24px 100px;">
        <div style="font-size:11px;color:var(--muted);font-weight:700;letter-spacing:.06em;margin-bottom:10px;">RAPPORT MENSUEL</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <div>
              <div style="font-size:13px;font-weight:700;color:var(--text);">Rapport Janvier 2026</div>
              <div style="font-size:10px;color:var(--muted);margin-top:2px;">847 vues ¬∑ 134 scans ¬∑ score moyen 82</div>
            </div>
            <div style="font-size:24px;">üìä</div>
          </div>
          <div style="display:flex;gap:8px;">
            <button onclick="showToast('üì• Rapport PDF t√©l√©charg√©')" style="flex:1;background:rgba(0,200,120,0.12);border:1px solid rgba(0,200,120,0.3);color:var(--green);border-radius:10px;padding:10px;font-size:11px;font-weight:700;cursor:pointer;">üì• T√©l√©charger PDF</button>
            <button onclick="showToast('üìß Rapport envoy√© par email')" style="flex:1;background:var(--card);border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px;font-size:11px;font-weight:600;cursor:pointer;">üìß Envoyer email</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SUB: R√âGLAGES -->
    <div class="owner-sub" id="ownerSettings">
      <div class="header-top" style="padding-top:8px;">
        <div><div class="section-title">R√©glages</div></div>
        <div class="back-btn" onclick="switchOwnerTab('home')">‚Üê Retour</div>
      </div>
      <div style="padding:40px 24px;text-align:center;color:var(--muted);">
        <div style="font-size:48px;margin-bottom:16px;">‚öôÔ∏è</div>
        <div style="font-size:13px;">G√©rez votre profil et vos pr√©f√©rences</div>
      </div>
    </div>

  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

</div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
const bars = [
  {
    name: "Le Vieux Murier",
    addr: "12 Place Plumereau, Tours",
    score: 82,
    type: "Bar ‚Ä¢ ERP Type N ‚Ä¢ 5e cat√©gorie",
    capacity: "40 personnes",
    distance: "320m",
    lastInspection: "14 juin 2025",
    nextInspection: "juin 2026",
    scoreClass: "",
    lat: 47.3953, lng: 0.6831,
    details: [
      {label:"Extincteurs",value:"‚úì Conformes",cls:"green"},
      {label:"Issues secours",value:"‚úì Conformes",cls:"green"},
      {label:"D√©tecteurs fum√©e",value:"‚ö† Partiel",cls:"orange"},
      {label:"√âclairage s√©cu.",value:"‚úì Conforme",cls:"green"},
      {label:"Affichages",value:"‚úì Conformes",cls:"green"},
      {label:"Derni√®re visite",value:"juin 2025",cls:""},
    ]
  },
  {
    name: "Bar du Centre",
    addr: "5 Rue Colbert, Tours",
    score: 78,
    type: "Bar brasserie ‚Ä¢ ERP Type N ‚Ä¢ 3e cat√©gorie",
    capacity: "80 personnes",
    distance: "150m",
    lastInspection: "3 mars 2025",
    nextInspection: "mars 2026",
    scoreClass: "orange",
    lat: 47.3935, lng: 0.6862,
    details: [
      {label:"Extincteurs",value:"‚úì Conformes",cls:"green"},
      {label:"Issues secours",value:"‚ö† Action req.",cls:"orange"},
      {label:"D√©tecteurs fum√©e",value:"‚úó Urgent",cls:"red"},
      {label:"√âclairage s√©cu.",value:"‚ö† Partiel",cls:"orange"},
      {label:"Affichages",value:"‚úì Conformes",cls:"green"},
      {label:"Derni√®re visite",value:"mars 2025",cls:""},
    ]
  },
  {
    name: "La Guinguette",
    addr: "8 Quai du Portillon, Tours",
    score: 85,
    type: "Bar concert ‚Ä¢ ERP Type L ‚Ä¢ 2e cat√©gorie",
    capacity: "120 personnes",
    distance: "480m",
    lastInspection: "22 sept. 2025",
    nextInspection: "sept. 2026",
    scoreClass: "",
    lat: 47.3928, lng: 0.6820,
    details: [
      {label:"Extincteurs",value:"‚úì Conformes",cls:"green"},
      {label:"Issues secours",value:"‚úì Conformes",cls:"green"},
      {label:"D√©tecteurs fum√©e",value:"‚úì Conformes",cls:"green"},
      {label:"√âclairage s√©cu.",value:"‚úì Conforme",cls:"green"},
      {label:"Affichages",value:"‚úì Conformes",cls:"green"},
      {label:"Derni√®re visite",value:"sept. 2025",cls:""},
    ]
  },
  {
    name: "Le Marais Social Club",
    addr: "18 Rue de Bretagne, Paris 3e",
    score: 91,
    type: "Bar cocktails ‚Ä¢ ERP Type N ‚Ä¢ 5e cat√©gorie",
    capacity: "60 personnes",
    distance: "Paris ‚Äî Pilote b√™ta",
    lastInspection: "8 nov. 2025",
    nextInspection: "nov. 2026",
    scoreClass: "",
    lat: 48.8627, lng: 2.3597,
    details: [
      {label:"Extincteurs",value:"‚úì Conformes",cls:"green"},
      {label:"Issues secours",value:"‚úì Conformes",cls:"green"},
      {label:"D√©tecteurs fum√©e",value:"‚úì Conformes",cls:"green"},
      {label:"√âclairage s√©cu.",value:"‚úì Conforme",cls:"green"},
      {label:"Affichages",value:"‚úì Conformes",cls:"green"},
      {label:"Derni√®re visite",value:"nov. 2025",cls:""},
    ]
  },
  {
    name: "Caf√© Oberkampf",
    addr: "3 Rue Oberkampf, Paris 11e",
    score: 74,
    type: "Bar concert ‚Ä¢ ERP Type L ‚Ä¢ 3e cat√©gorie",
    capacity: "150 personnes",
    distance: "Paris ‚Äî Pilote b√™ta",
    lastInspection: "5 oct. 2025",
    nextInspection: "oct. 2026",
    scoreClass: "orange",
    lat: 48.8651, lng: 2.3748,
    details: [
      {label:"Extincteurs",value:"‚úì Conformes",cls:"green"},
      {label:"Issues secours",value:"‚ö† Action req.",cls:"orange"},
      {label:"D√©tecteurs fum√©e",value:"‚úì Conformes",cls:"green"},
      {label:"√âclairage s√©cu.",value:"‚úì Conforme",cls:"green"},
      {label:"Registre s√©cu.",value:"‚ö† Incomplet",cls:"orange"},
      {label:"Derni√®re visite",value:"oct. 2025",cls:""},
    ]
  },
  {
    name: "Bar R√©publique",
    addr: "42 Bd du Temple, Paris 3e",
    score: 88,
    type: "Brasserie ‚Ä¢ ERP Type N ‚Ä¢ 2e cat√©gorie",
    capacity: "200 personnes",
    distance: "Paris ‚Äî Pilote b√™ta",
    lastInspection: "15 janv. 2026",
    nextInspection: "janv. 2027",
    scoreClass: "",
    lat: 48.8641, lng: 2.3623,
    details: [
      {label:"Extincteurs",value:"‚úì Conformes",cls:"green"},
      {label:"Issues secours",value:"‚úì Conformes",cls:"green"},
      {label:"D√©tecteurs fum√©e",value:"‚úì Conformes",cls:"green"},
      {label:"√âclairage s√©cu.",value:"‚úì Conforme",cls:"green"},
      {label:"Affichages",value:"‚úì Conformes",cls:"green"},
      {label:"Derni√®re visite",value:"janv. 2026",cls:""},
    ]
  },
  {
    name: "La Sc√®ne Bastille",
    addr: "7 Rue de la Roquette, Paris 11e",
    score: 71,
    type: "Bar PMU ‚Ä¢ ERP Type N ‚Ä¢ 5e cat√©gorie",
    capacity: "90 personnes",
    distance: "Paris ‚Äî Pilote b√™ta",
    lastInspection: "2 d√©c. 2025",
    nextInspection: "d√©c. 2026",
    scoreClass: "orange",
    lat: 48.8535, lng: 2.3710,
    details: [
      {label:"Extincteurs",value:"‚úì Conformes",cls:"green"},
      {label:"Issues secours",value:"‚úì Conformes",cls:"green"},
      {label:"D√©tecteurs fum√©e",value:"‚ö† Partiel",cls:"orange"},
      {label:"√âclairage s√©cu.",value:"‚ö† Action req.",cls:"orange"},
      {label:"Affichages",value:"‚úì Conformes",cls:"green"},
      {label:"Derni√®re visite",value:"d√©c. 2025",cls:""},
    ]
  }
];
function goTo(screen) {
  // Masquer tous les √©crans
  document.querySelectorAll('.screen').forEach(function(s) {
    s.classList.remove('active');
  });
  // Masquer toutes les tab bars
  document.querySelectorAll('.tab-bar').forEach(function(t) {
    t.classList.remove('visible');
  });
  // Afficher l'√©cran cible
  var target = document.getElementById(screen);
  if (target) {
    target.classList.add('active');
    target.scrollTop = 0;
  }
  // Afficher la bonne tab bar
  if (screen === 'client') {
    document.getElementById('tabClient').classList.add('visible');
    initGeolocation();
  }
  if (screen === 'barowner') {
    document.getElementById('tabBar').classList.add('visible');
    animateScore();
  }
}

// ‚îÄ‚îÄ MAP LEAFLET ‚îÄ‚îÄ
var leafletMap = null;

function buildMap() {
  if (leafletMap) { leafletMap.invalidateSize(); return; }

  leafletMap = L.map('leafletMap', {
    center: [47.3941, 0.6848],
    zoom: 15,
    zoomControl: false,
    attributionControl: false,
    dragging: true,
    scrollWheelZoom: false
  });

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(leafletMap);

  var barCoords = [
    { lat: 47.3953, lng: 0.6831, idx: 0, score: 82, name: 'Le Vieux Murier', cls: '' },
    { lat: 47.3935, lng: 0.6862, idx: 1, score: 78, name: 'Bar du Centre', cls: 'orange' },
    { lat: 47.3928, lng: 0.6820, idx: 2, score: 85, name: 'La Guinguette', cls: '' },
  ];

  barCoords.forEach(function(b) {
    var icon = L.divIcon({
      className: '',
      html: '<div class="spotafe-marker ' + b.cls + '">' + b.score + ' ‚Ä¢ ' + b.name + '</div>',
      iconAnchor: [0, 20]
    });
    L.marker([b.lat, b.lng], { icon: icon })
      .addTo(leafletMap)
      .on('click', function() { window.openModal(b.idx); });
  });

  var userIcon = L.divIcon({
    className: '',
    html: '<div style="width:14px;height:14px;background:#4A9EFF;border-radius:50%;border:3px solid white;box-shadow:0 0 0 5px rgba(74,158,255,0.25);"></div>',
    iconAnchor: [7, 7]
  });
  L.marker([47.3941, 0.6848], { icon: userIcon }).addTo(leafletMap);
}

function loadLeafletThenMap() {
  if (typeof L !== 'undefined') {
    buildMap();
    return;
  }
  var script = document.createElement('script');
  script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
  script.onload = function() { buildMap(); };
  script.onerror = function() { 
    document.getElementById('leafletMap').innerHTML = 
      '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:rgba(255,255,255,0.3);font-size:13px;">üì° Carte non disponible hors ligne</div>';
  };
  document.head.appendChild(script);
}

// ‚îÄ‚îÄ GEOLOCATION ‚îÄ‚îÄ
function initGeolocation() {
  var pill = document.getElementById('locationPill');
  var txt = document.getElementById('locationText');

  loadLeafletThenMap();

  if (!navigator.geolocation) {
    txt.textContent = 'Tours ‚Äî Pilote b√™ta';
    return;
  }

  txt.textContent = 'Localisation en cours‚Ä¶';

  navigator.geolocation.getCurrentPosition(
    function(pos) {
      txt.textContent = pos.coords.latitude.toFixed(4) + '¬∞N, ' + pos.coords.longitude.toFixed(4) + '¬∞E ‚Ä¢ Tours';
      pill.style.background = 'rgba(0,232,122,0.15)';
      if (leafletMap) leafletMap.panTo([pos.coords.latitude, pos.coords.longitude]);
    },
    function() { txt.textContent = 'Tours ‚Äî Pilote b√™ta'; },
    { timeout: 5000, maximumAge: 60000 }
  );
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ
var currentBarIdx = 0;

window.openModal = function openModal(idx) {
  currentBarIdx = idx;
  var bar = bars[idx];
  document.getElementById('modalName').textContent = bar.name;
  document.getElementById('modalAddr').textContent = bar.addr + ' ‚Ä¢ ' + bar.type;

  var scoreEl = document.getElementById('modalScore');
  scoreEl.textContent = bar.score;
  scoreEl.className = 'modal-score-num' + (bar.scoreClass ? ' ' + bar.scoreClass : '');

  var barFill = document.getElementById('modalBar');
  barFill.style.width = bar.score + '%';
  barFill.className = 'modal-score-bar-fill' + (bar.scoreClass ? ' ' + bar.scoreClass : '');

  var grid = document.getElementById('modalGrid');
  grid.innerHTML = bar.details.map(function(d) {
    return '<div class="modal-detail-item"><div class="modal-detail-label">' + d.label + '</div><div class="modal-detail-value ' + d.cls + '">' + d.value + '</div></div>';
  }).join('');

  // Masquer la carte, afficher le modal
  document.getElementById('mapContainer').style.display = 'none';
  document.getElementById('detailModal').classList.add('open');
}

function closeModal(e) {
  if (!e || e.target === document.getElementById('detailModal')) {
    document.getElementById('detailModal').classList.remove('open');
    // R√©afficher la carte
    document.getElementById('mapContainer').style.display = 'block';
    // Forcer Leaflet √† recalculer la taille
    if (leafletMap) {
      setTimeout(function() { leafletMap.invalidateSize(); }, 50);
    }
  }
}

// ‚îÄ‚îÄ SCORE ANIMATION ‚îÄ‚îÄ
function animateScore() {
  const el = document.getElementById('animatedScore');
  let current = 0;
  const target = 78;
  const duration = 1200;
  const step = target / (duration / 16);

  const timer = setInterval(() => {
    current = Math.min(current + step, target);
    el.textContent = Math.round(current);
    if (current >= target) clearInterval(timer);
  }, 16);
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2800);
}

// ‚îÄ‚îÄ NAVIGATION GPS ‚îÄ‚îÄ
function navigate() {
  var bar = bars[currentBarIdx];
  var lat = bar.lat;
  var lng = bar.lng;
  var name = encodeURIComponent(bar.name);
  var addr = encodeURIComponent(bar.addr);

  // D√©tection iPhone/iOS ‚Üí Apple Maps
  var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  var isMac = /Mac/.test(navigator.userAgent) && navigator.maxTouchPoints > 0;

  if (isIOS || isMac) {
    // Apple Maps ‚Äî ouvre l'app native Maps sur iPhone
    window.location.href = 'maps://maps.apple.com/?daddr=' + lat + ',' + lng + '&dirflg=w&q=' + name;
  } else {
    // Google Maps pour Android/Desktop
    window.open('https://www.google.com/maps/dir/?api=1&destination=' + lat + ',' + lng + '&destination_place_name=' + name + '&travelmode=walking', '_blank');
  }
}

// ‚îÄ‚îÄ PARTENAIRES ‚îÄ‚îÄ
var activeFilter = 'tous';

var partners = [
  {
    name: "UMIH ‚Äî Union des M√©tiers",
    type: "F√©d√©ration professionnelle CHR",
    logo: "üèõ",
    logoColor: "#1A1A3A",
    badges: ["pb-agr√©√©", "pb-local", "pb-certif"],
    badgeLabels: ["‚úì Partenaire officiel", "ü§ù 30 000 g√©rants", "CHR France"],
    tags: ["f√©d√©ration", "erp"],
    rating: 4.9, reviews: 312,
    delay: "Contact imm√©diat",
    price: "Partenaire officiel",
    city: "Tours (37) & France",
    phone: "umih.fr",
    services: ["R√©seau 30 000 g√©rants", "Accompagnement r√©glementaire", "√âv√©nements CHR", "Veille l√©gislative"],
    desc: "Premier partenaire Spotafe. L'UMIH r√©f√©rence Spotafe aupr√®s de ses 30 000 adh√©rents g√©rants de bars, restaurants et h√¥tels en France."
  },
  {
    name: "France Boissons (Heineken)",
    type: "Distributeur CHR national",
    logo: "üç∫",
    logoColor: "#1A2A1A",
    badges: ["pb-agr√©√©", "pb-rapide"],
    badgeLabels: ["‚úì Distribution nationale", "200K √©tablissements"],
    tags: ["distribution", "erp"],
    rating: 4.7, reviews: 198,
    delay: "Tourn√©e hebdomadaire",
    price: "Co-distribution",
    city: "France enti√®re",
    phone: "franceboissons.com",
    services: ["Distribution nationale CHR", "200 000 √©tablissements/semaine", "Pr√©sentation Spotafe en tourn√©e", "Commission apporteur d'affaires"],
    desc: "R√©seau de distribution Heineken pr√©sent chez 200 000 √©tablissements CHR chaque semaine. Les commerciaux France Boissons pr√©sentent Spotafe lors de leurs tourn√©es."
  },
  {
    name: "Apave Centre-Val de Loire",
    type: "Bureau de contr√¥le agr√©√©",
    logo: "üè¢",
    logoColor: "#1A3A6A",
    badges: ["pb-agr√©√©", "pb-local", "pb-certif"],
    badgeLabels: ["‚úì Agr√©√© Pr√©fecture", "üìç Tours", "ERP certifi√©"],
    tags: ["bureau", "erp"],
    rating: 4.8, reviews: 124,
    delay: "Sous 5 jours",
    price: "√Ä partir de 380‚Ç¨",
    city: "Tours (37)",
    phone: "02 47 XX XX XX",
    services: ["Visite de s√©curit√© ERP", "Rapport commission", "Suivi annuel", "Certification incendie"],
    desc: "Bureau de contr√¥le r√©f√©rence en r√©gion Centre. Intervient sur tous types d'ERP jusqu'√† la 1√®re cat√©gorie."
  },
  {
    name: "Bureau Veritas Centre",
    type: "Bureau de contr√¥le & certification",
    logo: "‚úÖ",
    logoColor: "#1A2A3A",
    badges: ["pb-agr√©√©", "pb-certif"],
    badgeLabels: ["‚úì Agr√©√© Pr√©fecture", "ERP certifi√©"],
    tags: ["bureau", "erp", "securite"],
    rating: 4.9, reviews: 201,
    delay: "Sous 10 jours",
    price: "√Ä partir de 450‚Ç¨",
    city: "Orl√©ans (45)",
    phone: "02 38 XX XX XX",
    services: ["Contr√¥le r√©glementaire ERP", "Commission de s√©curit√©", "Audit complet", "Rapport officiel"],
    desc: "Leader mondial du contr√¥le. Rapport reconnu par toutes les commissions de s√©curit√© de la r√©gion."
  },
  {
    name: "Socotec Indre-et-Loire",
    type: "Organisme de pr√©vention s√©curit√©",
    logo: "üî¨",
    logoColor: "#1A1A2E",
    badges: ["pb-agr√©√©", "pb-rapide", "pb-certif"],
    badgeLabels: ["‚úì Agr√©√© Minist√®re", "‚ö° Rapide", "ERP certifi√©"],
    tags: ["bureau", "erp", "rapide"],
    rating: 4.6, reviews: 89,
    delay: "Sous 48h",
    price: "√Ä partir de 290‚Ç¨",
    city: "Tours (37)",
    phone: "02 47 XX XX XX",
    services: ["Audit s√©curit√© ERP", "Mise en conformit√©", "Formation SSI", "Certification"],
    desc: "Interventions rapides garanties sous 48h. Sp√©cialiste des bars, restaurants et ERP de type N et L."
  },
  {
    name: "S√©curitas Protection",
    type: "Conseil en s√©curit√© incendie",
    logo: "üõ°Ô∏è",
    logoColor: "#1A2A1A",
    badges: ["pb-agr√©√©", "pb-local"],
    badgeLabels: ["‚úì Agr√©√©", "üìç Tours"],
    tags: ["securite"],
    rating: 4.5, reviews: 67,
    delay: "Sous 7 jours",
    price: "√Ä partir de 250‚Ç¨",
    city: "Tours (37)",
    phone: "02 47 XX XX XX",
    services: ["Installation extincteurs", "D√©tection incendie", "√âclairage s√©curit√©", "Formation √©vacuation"],
    desc: "Sp√©cialiste de l'installation et maintenance des √©quipements de s√©curit√© incendie. Contrats d'entretien annuels."
  },
  {
    name: "SafeConsult Tours",
    type: "Cabinet conseil ERP ind√©pendant",
    logo: "üíº",
    logoColor: "#2A1A1A",
    badges: ["pb-local", "pb-rapide"],
    badgeLabels: ["üìç Tours", "‚ö° Rapide"],
    tags: ["erp", "rapide"],
    rating: 4.7, reviews: 43,
    delay: "Sous 3 jours",
    price: "√Ä partir de 180‚Ç¨",
    city: "Tours (37)",
    phone: "02 47 XX XX XX",
    services: ["Pr√©-audit ERP", "Accompagnement dossier", "Conseil mise en conformit√©", "Pr√©paration visite"],
    desc: "Cabinet ind√©pendant sp√©cialis√© bars et restaurants. Pr√©parez votre dossier avant la commission officielle."
  }
];

function renderPartners(list) {
  var container = document.getElementById('partnersList');
  if (!list || list.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:40px 0;color:var(--muted);"><div style="font-size:36px;margin-bottom:12px;">üîç</div><div>Aucun partenaire trouv√©</div></div>';
    return;
  }
  document.getElementById('partnersCount').textContent = list.length + ' organisme' + (list.length > 1 ? 's' : '') + ' ‚Ä¢ Tours, Paris & France';
  container.innerHTML = list.map(function(p, i) {
    return '<div class="partner-card" id="pcard' + i + '">' +
      '<div class="partner-card-top">' +
        '<div class="partner-logo" style="background:' + p.logoColor + ';">' + p.logo + '</div>' +
        '<div class="partner-info">' +
          '<div class="partner-name">' + p.name + '</div>' +
          '<div class="partner-type">' + p.type + '</div>' +
          '<div class="partner-badges">' +
            p.badges.map(function(b, bi) {
              return '<span class="partner-badge ' + b + '">' + p.badgeLabels[bi] + '</span>';
            }).join('') +
          '</div>' +
        '</div>' +
      '</div>' +
      '<div class="partner-divider"></div>' +
      '<div class="partner-meta">' +
        '<div class="partner-meta-item">‚≠ê ' + p.rating + ' <span style="color:rgba(255,255,255,0.2)">(' + p.reviews + ' avis)</span></div>' +
        '<div class="partner-meta-item">üìç ' + p.city + '</div>' +
        '<div class="partner-meta-item">‚è± ' + p.delay + '</div>' +
      '</div>' +
      '<div class="partner-services">' +
        p.services.map(function(s) { return '<span class="partner-service">' + s + '</span>'; }).join('') +
      '</div>' +
      '<div style="font-size:12px;color:var(--muted);margin-bottom:14px;line-height:1.5;">' + p.desc + '</div>' +
      '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">' +
        '<div class="partner-price">' + p.price + ' <span>/ √©valuation</span></div>' +
      '</div>' +
      '<div class="partner-cta">' +
        '<button class="partner-btn partner-btn-primary" onclick="contactPartner(\' + p.name + \')">üìû Contacter</button>' +
        '<button class="partner-btn partner-btn-secondary" onclick="showToast(\'Devis envoy\u00e9 \' + p.name)">üí¨ Devis</button>' +
      '</div>' +
    '</div>';
  }).join('');
}

function filterPartners() {
  var search = document.getElementById('partnerSearch').value.toLowerCase();
  var filtered = partners.filter(function(p) {
    var matchFilter = activeFilter === 'tous' || p.tags.indexOf(activeFilter) !== -1;
    var matchSearch = search === '' ||
      p.name.toLowerCase().indexOf(search) !== -1 ||
      p.type.toLowerCase().indexOf(search) !== -1 ||
      p.city.toLowerCase().indexOf(search) !== -1 ||
      p.services.some(function(s) { return s.toLowerCase().indexOf(search) !== -1; });
    return matchFilter && matchSearch;
  });
  renderPartners(filtered);
}

function setFilter(filter, el) {
  activeFilter = filter;
  document.querySelectorAll('.filter-pill').forEach(function(p) { p.classList.remove('active'); });
  el.classList.add('active');
  filterPartners();
}

function contactPartner(name) {
  showToast('üìû Appel vers ' + name.split(' ')[0] + '‚Ä¶');
}

// ‚îÄ‚îÄ OWNER TAB NAVIGATION ‚îÄ‚îÄ
function switchOwnerTab(tab) {
  document.querySelectorAll('.owner-sub').forEach(function(s) { s.classList.remove('active'); });
  var tabs = ['Home', 'Analytics', 'Partners', 'Docs', 'Settings'];
  tabs.forEach(function(t) {
    var icon = document.getElementById('ownerTab' + t);
    var txt  = document.getElementById('ownerTab' + t + 'Txt');
    if (icon) icon.classList.remove('active');
    if (txt)  { txt.classList.remove('active'); txt.style.color = ''; }
  });
  var map = {
    'home':      { sub: 'ownerHome',      tab: 'Home' },
    'analytics': { sub: 'ownerAnalytics', tab: 'Analytics' },
    'partners':  { sub: 'ownerPartners',  tab: 'Partners' },
    'docs':      { sub: 'ownerDocs',      tab: 'Docs' },
    'settings':  { sub: 'ownerSettings',  tab: 'Settings' }
  };
  if (map[tab]) {
    var el   = document.getElementById(map[tab].sub);
    if (el)   el.classList.add('active');
    var icon = document.getElementById('ownerTab' + map[tab].tab);
    var txt  = document.getElementById('ownerTab' + map[tab].tab + 'Txt');
    if (icon) icon.classList.add('active');
    if (txt)  { txt.classList.add('active'); txt.style.color = 'var(--green)'; }
    if (tab === 'partners') renderPartners(partners);
    if (tab === 'analytics') { setTimeout(function(){ drawChart(); drawScoreHistory(); }, 80); }
    document.getElementById('barowner').scrollTop = 0;
  }
}

// ‚îÄ‚îÄ CLIENT NAVIGATION ‚îÄ‚îÄ
var currentClientTab = 'map';
var favorites = [];
var searchFilter = 'tous';

function switchClientTab(tab) {
  currentClientTab = tab;
  var tabs = ['Map','Favorites','Search','Profile'];
  tabs.forEach(function(t) {
    var ic = document.getElementById('ctab'+t);
    var tx = document.getElementById('ctab'+t+'Txt');
    if (ic) { ic.classList.remove('active'); }
    if (tx) { tx.classList.remove('active'); tx.style.color = ''; }
  });
  var ic = document.getElementById('ctab'+ tab.charAt(0).toUpperCase()+tab.slice(1));
  var tx = document.getElementById('ctab'+ tab.charAt(0).toUpperCase()+tab.slice(1)+'Txt');
  if (ic) ic.classList.add('active');
  if (tx) { tx.classList.add('active'); tx.style.color='var(--green)'; }

  // Afficher/masquer les √©l√©ments selon l'onglet
  var mapEls = ['mapContainer', 'clientMainContent'];
  var header = document.querySelector('#client .client-header');

  // Masquer tous les sub-screens client
  ['clientSubFavorites','clientSubSearch','clientSubProfile'].forEach(function(id){
    var el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });

  if (tab === 'map') {
    if (header) header.style.display = '';
    document.getElementById('mapContainer') && (document.getElementById('mapContainer').style.display = '');
    document.querySelectorAll('#client .bars-list').forEach(function(el){ el.style.display=''; });
    document.querySelectorAll('#client .section-title, #client .section-sub').forEach(function(el){ el.style.display=''; });
  } else {
    if (header) header.style.display = 'none';
    document.getElementById('mapContainer') && (document.getElementById('mapContainer').style.display = 'none');
    document.querySelectorAll('#client .bars-list').forEach(function(el){ el.style.display='none'; });
    var sub = document.getElementById('clientSub' + tab.charAt(0).toUpperCase()+tab.slice(1));
    if (sub) sub.style.display = '';
    if (tab === 'favorites') renderFavorites();
    if (tab === 'search')    { doClientSearch(); }
    if (tab === 'profile')   { document.getElementById('profileFavCount').textContent = favorites.length; }
  }
}

// ‚îÄ‚îÄ FAVORIS ‚îÄ‚îÄ
function toggleFavorite(idx) {
  var pos = favorites.indexOf(idx);
  if (pos === -1) {
    favorites.push(idx);
    showToast('‚≠ê ' + bars[idx].name + ' ajout√© aux favoris');
  } else {
    favorites.splice(pos, 1);
    showToast('üóë Retir√© des favoris');
  }
  renderFavorites();
}

function renderFavorites() {
  var list = document.getElementById('favList');
  var empty = document.getElementById('favEmpty');
  var count = document.getElementById('favCount');
  if (!list) return;
  if (favorites.length === 0) {
    list.innerHTML = '';
    if (empty) empty.style.display = '';
    if (count) count.textContent = '0 bar';
    return;
  }
  if (empty) empty.style.display = 'none';
  if (count) count.textContent = favorites.length + ' bar' + (favorites.length > 1 ? 's' : '');
  list.innerHTML = favorites.map(function(idx) {
    var b = bars[idx];
    var cls = b.scoreClass === 'orange' ? 'orange' : '';
    return '<div class="bar-card" onclick="openModal('+idx+')" style="position:relative;">' +
      '<div style="position:absolute;top:10px;right:10px;cursor:pointer;font-size:16px;" onclick="event.stopPropagation();toggleFavorite('+idx+')">‚≠ê</div>' +
      '<div class="bar-card-top" style="padding-right:36px;">' +
        '<div><div class="bar-name">'+b.name+'</div><div class="bar-type">'+b.addr+'</div></div>' +
        '<div class="score-badge '+cls+'"><div class="score-num '+cls+'">'+b.score+'</div><div class="score-label">/100</div></div>' +
      '</div>' +
      '<div class="score-bar-wrap"><div class="score-bar-track"><div class="score-bar-fill '+cls+'" style="width:'+b.score+'%"></div></div><div class="score-pct">'+b.score+'%</div></div>' +
    '</div>';
  }).join('');
}

// ‚îÄ‚îÄ RECHERCHE ‚îÄ‚îÄ
function setSearchFilter(f, el) {
  searchFilter = f;
  document.querySelectorAll('#searchFilters .filter-pill').forEach(function(p){ p.classList.remove('active'); });
  el.classList.add('active');
  doClientSearch();
}

function doClientSearch() {
  var q = (document.getElementById('clientSearchInput').value || '').toLowerCase().trim();
  var results = bars.filter(function(b) {
    var matchQ = !q || b.name.toLowerCase().includes(q) || b.addr.toLowerCase().includes(q) || b.type.toLowerCase().includes(q);
    var matchF = searchFilter === 'tous' ? true
      : searchFilter === 'top'   ? b.score >= 85
      : searchFilter === 'tours' ? b.addr.toLowerCase().includes('tours')
      : searchFilter === 'paris' ? b.addr.toLowerCase().includes('paris')
      : true;
    return matchQ && matchF;
  });

  var container = document.getElementById('searchResults');
  var empty = document.getElementById('searchEmpty');
  if (!container) return;

  if (results.length === 0) {
    container.innerHTML = '';
    if (empty) empty.style.display = '';
    return;
  }
  if (empty) empty.style.display = 'none';

  // Trier par score d√©croissant
  results.sort(function(a,b){ return b.score - a.score; });

  container.innerHTML = results.map(function(b) {
    var idx = bars.indexOf(b);
    var cls = b.scoreClass === 'orange' ? 'orange' : '';
    var isFav = favorites.indexOf(idx) !== -1;
    return '<div class="bar-card" onclick="openModal('+idx+')" style="position:relative;">' +
      '<div style="position:absolute;top:10px;right:10px;cursor:pointer;font-size:15px;" onclick="event.stopPropagation();toggleFavorite('+idx+')">'+(isFav?'‚≠ê':'‚òÜ')+'</div>' +
      '<div class="bar-card-top" style="padding-right:36px;">' +
        '<div><div class="bar-name">'+b.name+'</div><div class="bar-type">'+b.addr+'</div></div>' +
        '<div class="score-badge '+cls+'"><div class="score-num '+cls+'">'+b.score+'</div><div class="score-label">/100</div></div>' +
      '</div>' +
      '<div class="score-bar-wrap"><div class="score-bar-track"><div class="score-bar-fill '+cls+'" style="width:'+b.score+'%"></div></div><div class="score-pct">'+b.score+'%</div></div>' +
      '<div style="font-size:10px;color:var(--muted);margin-top:6px;">'+b.type+'</div>' +
    '</div>';
  }).join('');
}

// ‚îÄ‚îÄ PARENT MODULE ‚îÄ‚îÄ
var parentCurrentTab = 'live';

var parentLocations = [
  { name:'Le Marais Social Club', addr:'18 Rue de Bretagne, Paris 3e', score:91, safe:true,
    dot:{x:0.55,y:0.42}, color:'#00C878' },
  { name:'Caf√© Oberkampf',        addr:'3 Rue Oberkampf, Paris 11e',   score:74, safe:false,
    dot:{x:0.72,y:0.55}, color:'#FF8C00' },
  { name:'La Guinguette',         addr:'8 Quai du Portillon, Tours',   score:85, safe:true,
    dot:{x:0.30,y:0.65}, color:'#00C878' }
];
var parentCurrentLoc = 0;

function switchParentTab(tab) {
  parentCurrentTab = tab;
  ['live','history','settings'].forEach(function(t) {
    var sub  = document.getElementById('psub-'+t);
    var tabEl= document.getElementById('ptab-'+t);
    var icon = document.getElementById('ptabIcon' in window ? 'ptab'+t.charAt(0).toUpperCase()+t.slice(1)+'Icon' : '');
    var txt  = document.getElementById('ptab'+t.charAt(0).toUpperCase()+t.slice(1)+'Txt');
    if (sub)  sub.style.display  = t===tab ? '' : 'none';
    if (tabEl){
      tabEl.style.color       = t===tab ? '#A064FF' : 'var(--muted)';
      tabEl.style.borderBottom= t===tab ? '2px solid #A064FF' : '2px solid transparent';
      tabEl.style.fontWeight  = t===tab ? '700' : '600';
    }
    // tab bar bottom icons
    var bi = document.getElementById('ptab'+t.charAt(0).toUpperCase()+t.slice(1)+'Icon');
    var bt = document.getElementById('ptab'+t.charAt(0).toUpperCase()+t.slice(1)+'Txt');
    if (bi) { bi.classList.toggle('active', t===tab); }
    if (bt) { bt.classList.toggle('active', t===tab); bt.style.color = t===tab ? '#A064FF' : ''; }
  });
  if (tab === 'live') setTimeout(drawParentMap, 80);
}

function simulateLocation(idx) {
  parentCurrentLoc = idx;
  var loc = parentLocations[idx];
  var card = document.getElementById('safetyCard');
  var icon = document.getElementById('safetyIcon');
  var title= document.getElementById('safetyTitle');
  var sub  = document.getElementById('safetySubtitle');
  var score= document.getElementById('safetyScore');
  var venue= document.getElementById('currentVenue');
  var addr = document.getElementById('currentAddr');
  var upd  = document.getElementById('lastUpdate');

  if (loc.safe) {
    card.style.background = 'linear-gradient(135deg,rgba(0,200,120,0.12),rgba(0,200,120,0.04))';
    card.style.borderColor= 'rgba(0,200,120,0.35)';
    icon.textContent  = '‚úÖ';
    title.textContent = 'LIEU S√âCURIS√â';
    title.style.color = 'var(--green)';
    sub.textContent   = 'Score Spotafe ‚â• 85/100 ¬∑ V√©rifi√©';
    score.style.color = 'var(--green)';
  } else {
    card.style.background = 'linear-gradient(135deg,rgba(255,140,0,0.12),rgba(255,140,0,0.04))';
    card.style.borderColor= 'rgba(255,140,0,0.4)';
    icon.textContent  = '‚ö†Ô∏è';
    title.textContent = 'LIEU NON CERTIFI√â';
    title.style.color = 'var(--orange)';
    sub.textContent   = 'Score Spotafe < 85/100 ¬∑ V√©rification recommand√©e';
    score.style.color = 'var(--orange)';
  }
  score.textContent = loc.score;
  venue.textContent = 'üìç ' + loc.name;
  addr.textContent  = loc.addr;
  upd.textContent   = '√Ä l\'instant';
  if (!loc.safe) showToast('‚ö†Ô∏è Alerte : L√©a est dans un lieu non certifi√© !');
  else showToast('‚úÖ L√©a est dans un lieu s√©curis√©');
  drawParentMap();
}

function drawParentMap() {
  var canvas = document.getElementById('parentMapCanvas');
  if (!canvas) return;
  var ctx = canvas.getContext('2d');
  var dpr = window.devicePixelRatio || 1;
  var rect = canvas.getBoundingClientRect();
  canvas.width  = rect.width  * dpr;
  canvas.height = rect.height * dpr;
  ctx.scale(dpr, dpr);
  var W = rect.width, H = rect.height;
  var loc = parentLocations[parentCurrentLoc];

  // Fond carte simplifi√©
  ctx.fillStyle = '#0D0D18'; ctx.fillRect(0,0,W,H);

  // Rues simul√©es
  ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.lineWidth=6;
  [[0,H*0.35,W,H*0.35],[0,H*0.65,W,H*0.65],[W*0.25,0,W*0.25,H],[W*0.6,0,W*0.6,H],[W*0.45,0,W*0.45,H]].forEach(function(l){
    ctx.beginPath(); ctx.moveTo(l[0],l[1]); ctx.lineTo(l[2],l[3]); ctx.stroke();
  });
  ctx.strokeStyle='rgba(255,255,255,0.04)'; ctx.lineWidth=3;
  [[0,H*0.5,W,H*0.5],[W*0.15,0,W*0.15,H],[W*0.75,0,W*0.75,H]].forEach(function(l){
    ctx.beginPath(); ctx.moveTo(l[0],l[1]); ctx.lineTo(l[2],l[3]); ctx.stroke();
  });

  // Zone de rayon autour de la position
  var px = loc.dot.x * W, py = loc.dot.y * H;
  var rg = ctx.createRadialGradient(px,py,0,px,py,50);
  rg.addColorStop(0, loc.safe ? 'rgba(0,200,120,0.18)' : 'rgba(255,140,0,0.18)');
  rg.addColorStop(1, 'transparent');
  ctx.fillStyle = rg; ctx.beginPath(); ctx.arc(px,py,50,0,Math.PI*2); ctx.fill();

  // Point de position enfant
  ctx.beginPath(); ctx.arc(px,py,10,0,Math.PI*2);
  ctx.fillStyle = loc.color; ctx.fill();
  ctx.strokeStyle = '#07080A'; ctx.lineWidth=2; ctx.stroke();
  // Ic√¥ne enfant
  ctx.fillStyle='#fff'; ctx.font='bold 10px sans-serif'; ctx.textAlign='center';
  ctx.fillText('üßë', px, py+4);

  // Label lieu
  ctx.fillStyle='rgba(10,10,20,0.85)';
  var lw = ctx.measureText(loc.name).width + 16;
  ctx.roundRect ? ctx.roundRect(px-lw/2, py-30, lw, 16, 4) : ctx.rect(px-lw/2,py-30,lw,16);
  ctx.fill();
  ctx.fillStyle=loc.color; ctx.font='bold 9px sans-serif';
  ctx.fillText(loc.name, px, py-19);
}

// Initialiser la carte parent au chargement de l'√©cran
var _origGoTo = goTo;
goTo = function(screen) {
  _origGoTo(screen);
  if (screen === 'parent') {
    // Afficher la tab bar parent, masquer les autres
    document.querySelectorAll('.tab-bar').forEach(function(tb){ tb.classList.remove('visible'); });
    var tp = document.getElementById('tabParent');
    if (tp) tp.classList.add('visible');
    switchParentTab('live');
  }
};

// ‚îÄ‚îÄ FILTRE CARTE CLIENT ‚îÄ‚îÄ
var mapFilter = 'tous';
function applyMapFilter(f, el) {
  mapFilter = f;
  document.querySelectorAll('#clientMapFilters .filter-pill').forEach(function(p){ p.classList.remove('active'); });
  if (el) el.classList.add('active');
  document.querySelectorAll('#client .bar-card').forEach(function(card) {
    var idx = parseInt(card.getAttribute('data-idx'));
    if (isNaN(idx)) { card.style.display=''; return; }
    var b = bars[idx];
    var show = f==='tous' ? true
      : f==='top'     ? b.score >= 85
      : f==='warning' ? b.score < 80
      : f==='tours'   ? b.addr.toLowerCase().includes('tours')
      : f==='paris'   ? b.addr.toLowerCase().includes('paris')
      : f==='open'    ? !card.innerHTML.includes('Ferm√©')
      : true;
    card.style.display = show ? '' : 'none';
  });
}

// ‚îÄ‚îÄ ANALYTICS ‚îÄ‚îÄ
var currentPeriod = 30;

// Donn√©es simul√©es pour le graphe historique 12 mois
var scoreHistory = [71, 71, 73, 74, 75, 76, 77, 78, 78, 80, 81, 82];
var scoreMonths  = ['F','M','A','M','J','J','A','S','O','N','D','J'];

function drawScoreHistory() {
  var canvas = document.getElementById('scoreHistoryChart');
  if (!canvas) return;
  var ctx = canvas.getContext('2d');
  var dpr = window.devicePixelRatio || 1;
  var rect = canvas.getBoundingClientRect();
  canvas.width  = rect.width  * dpr;
  canvas.height = rect.height * dpr;
  ctx.scale(dpr, dpr);
  var W = rect.width, H = rect.height;
  var data = scoreHistory;
  var minV = 60, maxV = 100;
  var pad  = {l:22, r:8, t:8, b:14};
  var cw = W - pad.l - pad.r;
  var ch = H - pad.t - pad.b;
  var step = cw / (data.length - 1);

  ctx.clearRect(0,0,W,H);

  // Grille
  ctx.strokeStyle = 'rgba(255,255,255,0.05)'; ctx.lineWidth = 0.7;
  [60,70,80,90,100].forEach(function(v){
    var y = pad.t + ch - ((v-minV)/(maxV-minV))*ch;
    ctx.beginPath(); ctx.moveTo(pad.l,y); ctx.lineTo(W-pad.r,y); ctx.stroke();
    ctx.fillStyle='rgba(85,85,106,0.7)'; ctx.font='7px sans-serif'; ctx.textAlign='right';
    ctx.fillText(v, pad.l-3, y+3);
  });

  // Aire
  var grad = ctx.createLinearGradient(0,pad.t,0,pad.t+ch);
  grad.addColorStop(0,'rgba(232,184,75,0.25)'); grad.addColorStop(1,'rgba(232,184,75,0.02)');
  ctx.beginPath(); ctx.moveTo(pad.l, pad.t+ch);
  data.forEach(function(v,i){
    var x=pad.l+i*step; var y=pad.t+ch-((v-minV)/(maxV-minV))*ch;
    ctx.lineTo(x,y);
  });
  ctx.lineTo(pad.l+(data.length-1)*step, pad.t+ch); ctx.closePath();
  ctx.fillStyle=grad; ctx.fill();

  // Ligne
  ctx.beginPath(); ctx.strokeStyle='#E8B84B'; ctx.lineWidth=2; ctx.lineJoin='round';
  data.forEach(function(v,i){
    var x=pad.l+i*step; var y=pad.t+ch-((v-minV)/(maxV-minV))*ch;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  }); ctx.stroke();

  // Point final (aujourd'hui)
  var lx=pad.l+(data.length-1)*step;
  var ly=pad.t+ch-((data[data.length-1]-minV)/(maxV-minV))*ch;
  ctx.beginPath(); ctx.arc(lx,ly,4,0,Math.PI*2);
  ctx.fillStyle='#E8B84B'; ctx.fill();
  ctx.strokeStyle='#07080A'; ctx.lineWidth=2; ctx.stroke();

  // Valeur du dernier point
  ctx.fillStyle='#E8B84B'; ctx.font='bold 8px sans-serif'; ctx.textAlign='center';
  ctx.fillText(data[data.length-1], lx, ly-7);

  // Labels mois
  ctx.fillStyle='rgba(85,85,106,0.8)'; ctx.font='7px sans-serif'; ctx.textAlign='center';
  data.forEach(function(_,i){
    if(i%2===0||i===data.length-1){
      ctx.fillText(scoreMonths[i], pad.l+i*step, H-1);
    }
  });
}

// Appeler drawScoreHistory apr√®s drawChart


var visitData = {
  7:  [18,22,15,30,27,19,24],
  30: [12,18,14,22,16,28,20,15,24,19,30,22,18,26,31,24,17,20,28,23,15,19,27,22,34,28,19,24,31,26],
  90: (function(){var d=[];for(var i=0;i<90;i++){d.push(Math.floor(10+Math.random()*30+Math.sin(i/7)*8));}return d;})()
};

function drawChart() {
  var canvas = document.getElementById('analyticsChart');
  if (!canvas) return;
  var ctx = canvas.getContext('2d');
  var dpr = window.devicePixelRatio || 1;
  var rect = canvas.getBoundingClientRect();
  canvas.width  = rect.width  * dpr;
  canvas.height = rect.height * dpr;
  ctx.scale(dpr, dpr);
  var W = rect.width, H = rect.height;
  var data = visitData[currentPeriod];
  var max  = Math.max.apply(null, data);
  var pad  = {l:28, r:8, t:10, b:18};
  var cw   = W - pad.l - pad.r;
  var ch   = H - pad.t - pad.b;
  var step = cw / (data.length - 1);

  ctx.clearRect(0, 0, W, H);

  // Grille horizontale
  ctx.strokeStyle = 'rgba(255,255,255,0.05)';
  ctx.lineWidth = 0.8;
  [0, 0.25, 0.5, 0.75, 1].forEach(function(t) {
    var y = pad.t + ch * (1 - t);
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(W - pad.r, y); ctx.stroke();
    ctx.fillStyle = 'rgba(85,85,106,0.8)';
    ctx.font = '8px sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText(Math.round(max * t), pad.l - 4, y + 3);
  });

  // Aire sous la courbe (gradient vert)
  var grad = ctx.createLinearGradient(0, pad.t, 0, pad.t + ch);
  grad.addColorStop(0,   'rgba(0,200,120,0.35)');
  grad.addColorStop(1,   'rgba(0,200,120,0.02)');
  ctx.beginPath();
  ctx.moveTo(pad.l, pad.t + ch);
  data.forEach(function(v, i) {
    var x = pad.l + i * step;
    var y = pad.t + ch - (v / max) * ch;
    i === 0 ? ctx.lineTo(x, y) : ctx.lineTo(x, y);
  });
  ctx.lineTo(pad.l + (data.length - 1) * step, pad.t + ch);
  ctx.closePath();
  ctx.fillStyle = grad;
  ctx.fill();

  // Ligne de la courbe
  ctx.beginPath();
  ctx.strokeStyle = '#00C878';
  ctx.lineWidth = 2;
  ctx.lineJoin = 'round';
  data.forEach(function(v, i) {
    var x = pad.l + i * step;
    var y = pad.t + ch - (v / max) * ch;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });
  ctx.stroke();

  // Point du jour le plus r√©cent
  var lastX = pad.l + (data.length - 1) * step;
  var lastY = pad.t + ch - (data[data.length - 1] / max) * ch;
  ctx.beginPath();
  ctx.arc(lastX, lastY, 4, 0, Math.PI * 2);
  ctx.fillStyle = '#00C878';
  ctx.fill();
  ctx.strokeStyle = '#07080A';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Labels axe X
  ctx.fillStyle = 'rgba(85,85,106,0.8)';
  ctx.font = '8px sans-serif';
  ctx.textAlign = 'center';
  var labels = currentPeriod === 7
    ? ['L','M','M','J','V','S','D']
    : currentPeriod === 30
      ? ['J-30','','','','J-25','','','','J-20','','','','J-15','','','','J-10','','','','J-5','','','','','','','','','','Auj']
      : ['J-90','','','','','','','','','J-80','','','','','','','','','J-70','','','','','','','','','J-60','','','','','','','','','J-50','','','','','','','','','J-40','','','','','','','','','J-30','','','','','','','','','J-20','','','','','','','','','J-10','','','','','','','','','Auj'];
  var step2 = Math.max(1, Math.floor(data.length / 6));
  data.forEach(function(v, i) {
    if (i % step2 === 0 || i === data.length - 1) {
      var x = pad.l + i * step;
      var lbl = labels[i] || '';
      if (lbl) ctx.fillText(lbl, x, H - 2);
    }
  });
}

function setPeriod(days) {
  currentPeriod = days;
  [7, 30, 90].forEach(function(d) {
    var el = document.getElementById('period' + d);
    if (!el) return;
    if (d === days) {
      el.style.background = 'rgba(0,200,120,0.15)';
      el.style.border = '1px solid rgba(0,200,120,0.4)';
      el.style.color = 'var(--green)';
      el.style.fontWeight = '700';
    } else {
      el.style.background = 'var(--card)';
      el.style.border = '1px solid var(--border)';
      el.style.color = 'var(--muted)';
      el.style.fontWeight = '';
    }
  });
  drawChart();
  // Mettre √† jour le sous-titre p√©riode
  var sub = document.querySelector('#ownerAnalytics .section-title + *');
  // Mettre √† jour les KPIs selon p√©riode
  var kpiVues  = { 7: '198', 30: '847',  90: '2 341' };
  var kpiScans = { 7:  '31', 30: '134',  90:  '389'  };
  var kpiTrend = { 7: '+8%', 30: '+23%', 90: '+67%'  };
  var elVues = document.querySelector('#ownerAnalytics .kpi-vues');
  var elScans = document.querySelector('#ownerAnalytics .kpi-scans');
  if (elVues)  elVues.textContent  = kpiVues[days];
  if (elScans) elScans.textContent = kpiScans[days];
}

// ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ
function updateClock() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  document.getElementById('clock').textContent = h + ':' + m;
}
updateClock();
setInterval(updateClock, 1000);
</script>
</body>
</html>
